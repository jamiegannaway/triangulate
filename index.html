<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>triangulate.dev — workforce data platform</title>
  <meta name="description" content="triangulate.dev — comprehensive workforce intelligence platform. Understand your workforce needs from any starting point." />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #0a0b0d;
      --bg-gradient-1: rgba(99, 102, 241, 0.08);
      --bg-gradient-2: rgba(139, 92, 246, 0.06);
      --panel: #0f1014;
      --panel2: #14161c;
      --text: #f0f0f5;
      --text-secondary: #a0a0b0;
      --muted: #70708a;
      --muted2: #50506a;
      --border: rgba(255,255,255,.06);
      --border2: rgba(255,255,255,.10);
      --border-hover: rgba(255,255,255,.18);
      --accent: #818cf8;
      --accent2: #a78bfa;
      --accent-glow: rgba(129, 140, 248, 0.25);
      --shadow: 0 4px 24px rgba(0,0,0,.4);
      --radius: 16px;
      --radius-sm: 10px;
      --success: #10b981;
      --warning: #f59e0b;
      --coral: #f87171;
    }
    [data-theme="light"] {
      --bg: #f8f9fc;
      --bg-gradient-1: rgba(99, 102, 241, 0.06);
      --bg-gradient-2: rgba(139, 92, 246, 0.04);
      --panel: #ffffff;
      --panel2: #f0f1f5;
      --text: #1a1a2e;
      --text-secondary: #4a4a6a;
      --muted: #6a6a8a;
      --muted2: #8a8aa0;
      --border: rgba(0,0,0,.08);
      --border2: rgba(0,0,0,.12);
      --border-hover: rgba(99, 102, 241, 0.3);
      --accent: #6366f1;
      --accent2: #8b5cf6;
      --accent-glow: rgba(99, 102, 241, 0.2);
      --shadow: 0 4px 24px rgba(0,0,0,.08);
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Space Grotesk', -apple-system, BlinkMacSystemFont, sans-serif;
      background: radial-gradient(ellipse 80% 50% at 20% -10%, var(--bg-gradient-1), transparent),
        radial-gradient(ellipse 60% 40% at 80% 10%, var(--bg-gradient-2), transparent), var(--bg);
      color: var(--text);
      min-height: 100vh;
      transition: background 0.3s ease, color 0.3s ease;
    }
    .wrap { max-width: 1200px; margin: 0 auto; padding: 24px 24px 80px; }
    header { display: flex; align-items: center; justify-content: space-between; gap: 16px; padding: 16px 0 32px; flex-wrap: wrap; }
    .brand { display: flex; align-items: center; gap: 14px; }
    .logo { width: 42px; height: 42px; border-radius: 12px; background: linear-gradient(135deg, var(--accent), var(--accent2)); box-shadow: var(--shadow), 0 0 20px var(--accent-glow); position: relative; overflow: hidden; }
    .logo::before { content: ""; position: absolute; inset: 0; background: linear-gradient(135deg, transparent 40%, rgba(255,255,255,0.3) 50%, transparent 60%); animation: shimmer 3s infinite; }
    @keyframes shimmer { 0% { transform: translateX(-100%) rotate(45deg); } 100% { transform: translateX(100%) rotate(45deg); } }
    .brand h1 { font-size: 18px; font-weight: 600; letter-spacing: -0.3px; }
    .header-actions { display: flex; align-items: center; gap: 12px; }
    .theme-toggle { width: 44px; height: 44px; border-radius: 12px; border: 1px solid var(--border); background: var(--panel); cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s ease; }
    .theme-toggle:hover { border-color: var(--border-hover); background: var(--panel2); }
    .theme-toggle svg { width: 20px; height: 20px; color: var(--text-secondary); transition: color 0.2s ease; }
    .theme-toggle:hover svg { color: var(--accent); }
    .sun-icon { display: none; } .moon-icon { display: block; }
    [data-theme="light"] .sun-icon { display: block; } [data-theme="light"] .moon-icon { display: none; }
    .btn-ghost { padding: 10px 16px; border: 1px solid var(--border); background: transparent; color: var(--text-secondary); font-family: inherit; font-size: 13px; font-weight: 500; border-radius: var(--radius-sm); cursor: pointer; transition: all 0.2s; }
    .btn-ghost:hover { border-color: var(--border-hover); color: var(--text); background: var(--panel); }
    .btn-primary { display: inline-flex; align-items: center; gap: 10px; padding: 12px 20px; border-radius: 12px; border: 1px solid var(--accent); background: linear-gradient(135deg, rgba(129, 140, 248, 0.15), rgba(167, 139, 250, 0.1)); color: var(--text); font-weight: 600; font-size: 14px; cursor: pointer; transition: all 0.25s ease; font-family: inherit; }
    .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 8px 24px var(--accent-glow); }
    .btn-primary svg { width: 18px; height: 18px; }
    .card { border: 1px solid var(--border); background: var(--panel); border-radius: var(--radius); box-shadow: var(--shadow); }
    .badge { display: inline-flex; align-items: center; gap: 8px; padding: 8px 14px; border: 1px solid var(--border); background: rgba(129, 140, 248, 0.1); border-radius: 999px; color: var(--accent); font-size: 12px; font-weight: 500; }
    .badge::before { content: ""; width: 6px; height: 6px; border-radius: 50%; background: var(--accent); animation: pulse 2s infinite; }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.4; } }
    .screen { display: none; animation: fadeIn 0.4s ease; }
    .screen.active { display: block; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(12px); } to { opacity: 1; transform: translateY(0); } }

    /* ENTRY SCREEN */
    .entry-container { max-width: 800px; margin: 0 auto; }
    .entry-header { text-align: center; margin-bottom: 40px; }
    .entry-header .badge { margin-bottom: 20px; }
    .title { font-size: 40px; line-height: 1.1; font-weight: 700; letter-spacing: -1.5px; margin-bottom: 16px; background: linear-gradient(135deg, var(--text) 0%, var(--text-secondary) 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
    .subtitle { color: var(--text-secondary); font-size: 16px; line-height: 1.6; max-width: 560px; margin: 0 auto 24px; }
    
    /* Data Sources Button */
    .data-sources-link {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      padding: 12px 20px;
      border: 1px solid rgba(16, 185, 129, 0.4);
      background: rgba(16, 185, 129, 0.08);
      border-radius: 999px;
      color: var(--success);
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.25s ease;
      text-decoration: none;
      margin-bottom: 8px;
    }
    .data-sources-link:hover {
      border-color: rgba(16, 185, 129, 0.6);
      background: rgba(16, 185, 129, 0.12);
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(16, 185, 129, 0.2);
    }
    .data-sources-link svg {
      width: 18px;
      height: 18px;
    }
    .data-sources-link .verified-icon {
      width: 18px;
      height: 18px;
      background: var(--success);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .data-sources-link .verified-icon svg {
      width: 12px;
      height: 12px;
      color: white;
    }
    
    .helper-box { background: rgba(129, 140, 248, 0.06); border: 1px solid rgba(129, 140, 248, 0.15); border-radius: var(--radius-sm); padding: 20px 24px; margin-bottom: 32px; }
    .helper-title { font-size: 14px; font-weight: 600; color: var(--accent); margin-bottom: 10px; display: flex; align-items: center; justify-content: center; gap: 8px; }
    .helper-title svg { width: 18px; height: 18px; }
    .helper-text { font-size: 14px; color: var(--text-secondary); line-height: 1.6; text-align: center; }
    .helper-paths { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 14px; justify-content: center; }
    .helper-path { display: inline-flex; align-items: center; gap: 6px; padding: 8px 14px; background: var(--panel); border: 1px solid var(--border); border-radius: 999px; font-size: 12px; color: var(--text-secondary); }
    .helper-path-icon { width: 16px; height: 16px; border-radius: 4px; display: flex; align-items: center; justify-content: center; font-size: 10px; font-weight: 600; }
    .helper-path-icon.t { background: rgba(59, 130, 246, 0.2); color: #60a5fa; }
    .helper-path-icon.s { background: rgba(167, 139, 250, 0.2); color: var(--accent2); }
    .helper-path-icon.j { background: rgba(16, 185, 129, 0.2); color: var(--success); }
    .helper-path-icon.o { background: rgba(248, 113, 113, 0.2); color: var(--coral); }
    .helper-path-icon.p { background: rgba(245, 158, 11, 0.2); color: var(--warning); }
    .entry-inputs-container { display: flex; flex-direction: column; gap: 24px; margin-bottom: 32px; }
    .typeahead-container { position: relative; }
    .typeahead-dropdown { position: absolute; top: 100%; left: 0; right: 0; background: var(--panel); border: 1px solid var(--border); border-radius: var(--radius-sm); margin-top: 4px; max-height: 200px; overflow-y: auto; z-index: 100; display: none; box-shadow: var(--shadow); }
    .typeahead-dropdown.visible { display: block; }
    .typeahead-item { padding: 12px 18px; cursor: pointer; font-size: 14px; color: var(--text-secondary); transition: all 0.15s ease; border-bottom: 1px solid var(--border); }
    .typeahead-item:last-child { border-bottom: none; }
    .typeahead-item:hover { background: rgba(129, 140, 248, 0.1); color: var(--text); }
    .typeahead-item .typeahead-match { color: var(--accent); font-weight: 600; }
    .entry-card { background: var(--panel); border: 2px solid var(--border); border-radius: var(--radius); padding: 28px; transition: all 0.3s ease; }
    .entry-card:focus-within { border-color: var(--accent); box-shadow: 0 0 0 4px var(--accent-glow), var(--shadow); }
    .entry-card-header { display: flex; align-items: center; gap: 16px; margin-bottom: 18px; }
    .entry-card-num { width: 44px; height: 44px; border-radius: 12px; background: linear-gradient(135deg, var(--accent), var(--accent2)); color: white; font-size: 18px; font-weight: 700; display: flex; align-items: center; justify-content: center; flex-shrink: 0; box-shadow: 0 4px 12px var(--accent-glow); }
    .entry-card-label { font-size: 18px; font-weight: 600; color: var(--text); }
    .entry-card-label .optional { font-size: 13px; font-weight: 400; color: var(--muted); margin-left: 8px; }
    .entry-input { width: 100%; padding: 18px 22px; border: 1px solid var(--border); border-radius: var(--radius-sm); background: var(--panel2); color: var(--text); font-family: inherit; font-size: 16px; outline: none; transition: all 0.2s; }
    .entry-input::placeholder { color: var(--muted2); }
    .entry-input:focus { border-color: var(--accent); background: var(--panel); }
    .entry-input.textarea { min-height: 120px; resize: vertical; }
    .entry-actions { display: flex; justify-content: center; margin-bottom: 40px; }
    .btn-analyze { padding: 20px 48px; border: none; border-radius: var(--radius); background: linear-gradient(135deg, var(--accent), var(--accent2)); color: white; font-family: inherit; font-size: 18px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; gap: 12px; box-shadow: 0 8px 32px var(--accent-glow); }
    .btn-analyze:hover { transform: translateY(-3px); box-shadow: 0 12px 40px var(--accent-glow); }
    .btn-analyze svg { width: 22px; height: 22px; }
    .examples-section { margin-bottom: 48px; text-align: center; }
    .examples-label { font-size: 12px; color: var(--muted); text-transform: uppercase; letter-spacing: 1.5px; margin-bottom: 14px; }
    .examples-grid { display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; }
    .example-chip { padding: 10px 18px; border: 1px solid var(--border); border-radius: 999px; background: transparent; color: var(--text-secondary); font-family: inherit; font-size: 13px; cursor: pointer; transition: all 0.2s; }
    .example-chip:hover { border-color: var(--accent); color: var(--text); background: rgba(129, 140, 248, 0.08); }

    /* Info Cards Bottom */
    .info-cards-row { display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; padding-top: 40px; border-top: 1px solid var(--border); }
    @media (max-width: 900px) { .info-cards-row { grid-template-columns: repeat(2, 1fr); } }
    @media (max-width: 500px) { .info-cards-row { grid-template-columns: 1fr; } }
    .info-card { background: var(--panel); border: 1px solid var(--border); border-radius: var(--radius); padding: 24px; text-align: center; transition: all 0.2s ease; }
    .info-card:hover { border-color: var(--border-hover); transform: translateY(-2px); }
    .info-card-icon { width: 48px; height: 48px; margin: 0 auto 16px; border-radius: 12px; display: flex; align-items: center; justify-content: center; }
    .info-card-icon svg { width: 24px; height: 24px; }
    .info-card-icon.purple { background: rgba(129, 140, 248, 0.15); color: var(--accent); }
    .info-card-icon.green { background: rgba(16, 185, 129, 0.15); color: var(--success); }
    .info-card-icon.orange { background: rgba(245, 158, 11, 0.15); color: var(--warning); }
    .info-card-icon.coral { background: rgba(248, 113, 113, 0.15); color: var(--coral); }
    .info-card-title { font-size: 15px; font-weight: 600; color: var(--text); margin-bottom: 8px; }
    .info-card-desc { font-size: 13px; color: var(--muted); line-height: 1.5; }

    /* INTERPRETING */
    .interpreting-container { max-width: 640px; margin: 0 auto; padding: 40px 20px; }
    .interpreting-header { display: flex; align-items: center; gap: 14px; margin-bottom: 32px; }
    .spinner { width: 24px; height: 24px; border: 2px solid var(--border); border-top-color: var(--accent); border-radius: 50%; animation: spin 0.8s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }
    .interpreting-title { font-size: 20px; font-weight: 600; }
    .detected-card { background: var(--panel); border: 1px solid var(--border); border-radius: var(--radius); padding: 24px; margin-bottom: 20px; }
    .detected-label { font-family: 'JetBrains Mono', monospace; font-size: 11px; text-transform: uppercase; letter-spacing: 1.5px; color: var(--muted); margin-bottom: 16px; }
    .detected-items { display: flex; flex-direction: column; gap: 12px; }
    .detected-item { display: flex; align-items: center; gap: 14px; padding: 12px 16px; background: var(--panel2); border-radius: var(--radius-sm); }
    .detected-icon { width: 36px; height: 36px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 14px; font-weight: 600; }
    .detected-icon.title { background: rgba(59, 130, 246, 0.15); color: #60a5fa; }
    .detected-icon.jtbd { background: rgba(16, 185, 129, 0.15); color: var(--success); }
    .detected-icon.skill { background: rgba(167, 139, 250, 0.15); color: var(--accent2); }
    .detected-icon.outcome { background: rgba(248, 113, 113, 0.15); color: var(--coral); }
    .detected-icon.problem { background: rgba(245, 158, 11, 0.15); color: var(--warning); }
    .detected-text { flex: 1; }
    .detected-type { font-size: 11px; color: var(--muted); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 2px; }
    .detected-value { font-size: 14px; color: var(--text); }
    .clarification-card { background: var(--panel); border: 1px solid var(--border); border-radius: var(--radius); padding: 24px; margin-bottom: 20px; }
    .clarification-question { font-size: 15px; color: var(--text); margin-bottom: 16px; line-height: 1.5; }
    .clarification-options { display: flex; flex-wrap: wrap; gap: 10px; }
    .clarification-option { flex: 1; min-width: 120px; padding: 14px 16px; border: 1px solid var(--border); border-radius: var(--radius-sm); background: transparent; color: var(--text-secondary); font-family: inherit; font-size: 13px; cursor: pointer; transition: all 0.2s; text-align: center; }
    .clarification-option:hover { border-color: var(--accent); color: var(--text); background: rgba(129, 140, 248, 0.08); }
    .clarification-option.selected { border-color: var(--accent); background: var(--accent); color: white; }
    .clarification-note { font-size: 12px; color: var(--muted); font-style: italic; margin-top: 16px; text-align: center; }

    /* WORKSPACE */
    .workspace-header { margin-bottom: 24px; }
    .workspace-breadcrumb { font-family: 'JetBrains Mono', monospace; font-size: 11px; text-transform: uppercase; letter-spacing: 1.5px; color: var(--muted); margin-bottom: 8px; }
    .workspace-title-row { display: flex; align-items: flex-start; justify-content: space-between; gap: 20px; flex-wrap: wrap; }
    .workspace-title { font-size: 28px; font-weight: 700; letter-spacing: -0.5px; margin-bottom: 8px; }
    .workspace-subtitle { color: var(--text-secondary); font-size: 14px; }
    .workspace-actions { display: flex; gap: 10px; flex-wrap: wrap; }
    .btn-scenario, .btn-mcp, .btn-deep-dive { padding: 10px 18px; font-family: inherit; font-size: 13px; font-weight: 500; border-radius: var(--radius-sm); cursor: pointer; transition: all 0.2s; display: flex; align-items: center; gap: 8px; }
    .btn-scenario svg, .btn-mcp svg, .btn-deep-dive svg { width: 16px; height: 16px; }
    .btn-scenario { border: 1px solid rgba(245, 158, 11, 0.4); background: rgba(245, 158, 11, 0.1); color: var(--warning); }
    .btn-scenario:hover { background: rgba(245, 158, 11, 0.15); border-color: rgba(245, 158, 11, 0.6); }
    .btn-mcp { border: 1px solid rgba(16, 185, 129, 0.4); background: rgba(16, 185, 129, 0.1); color: var(--success); }
    .btn-mcp:hover { background: rgba(16, 185, 129, 0.15); border-color: rgba(16, 185, 129, 0.6); }
    .btn-deep-dive { border: 1px solid var(--accent); background: rgba(129, 140, 248, 0.1); color: var(--accent); }
    .btn-deep-dive:hover { background: rgba(129, 140, 248, 0.15); }
    .panels-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; }
    @media (max-width: 1000px) { .panels-grid { grid-template-columns: 1fr; } }
    .panel { background: var(--panel); border: 1px solid var(--border); border-radius: var(--radius); overflow: hidden; }
    .panel.full-width { grid-column: 1 / -1; }
    .panel-header { padding: 18px 22px; border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 12px; }
    .panel-title { font-size: 14px; font-weight: 600; }
    .panel-toggle { display: flex; gap: 4px; padding: 4px; background: var(--panel2); border-radius: 8px; }
    .panel-toggle-btn { padding: 6px 12px; border: none; background: transparent; color: var(--muted); font-family: inherit; font-size: 11px; border-radius: 6px; cursor: pointer; transition: all 0.2s; }
    .panel-toggle-btn.active { background: var(--bg); color: var(--text); }
    .panel-body { padding: 22px; }

    /* Analysis Panel Common */
    .analysis-definition { font-size: 12px; color: var(--muted); font-style: italic; margin-bottom: 20px; padding-bottom: 16px; border-bottom: 1px solid var(--border); line-height: 1.5; }
    .panels-grid > .panel:not(.full-width) { min-height: 580px; display: flex; flex-direction: column; }
    .panels-grid > .panel:not(.full-width) .panel-body { flex: 1; display: flex; flex-direction: column; }

    /* Job Analysis */
    .job-analysis-container { display: grid; grid-template-columns: 1fr 1fr; gap: 24px; flex: 1; }
    @media (max-width: 700px) { .job-analysis-container { grid-template-columns: 1fr; } }
    .job-section { background: var(--panel2); border-radius: var(--radius-sm); padding: 16px; display: flex; flex-direction: column; }
    .job-section-title { font-size: 12px; text-transform: uppercase; letter-spacing: 1.2px; color: var(--accent); margin-bottom: 14px; font-weight: 600; display: flex; align-items: center; gap: 8px; }
    .job-section-title svg { width: 16px; height: 16px; }
    .seniority-list { display: flex; flex-direction: column; gap: 6px; flex: 1; justify-content: center; }
    .seniority-item { display: flex; align-items: center; gap: 10px; padding: 12px 14px; background: var(--panel); border: 1px solid var(--border); border-radius: 8px; transition: all 0.2s ease; }
    .seniority-item:hover { border-color: var(--border-hover); }
    .seniority-item.active { border-color: var(--accent); background: rgba(129, 140, 248, 0.08); transform: scale(1.02); }
    .seniority-item.adjacent { opacity: 0.7; }
    .seniority-item.distant { opacity: 0.4; transform: scale(0.95); }
    .seniority-arrow { color: var(--muted); font-size: 10px; text-align: center; padding: 4px 0; }
    .seniority-title { font-size: 13px; font-weight: 500; color: var(--text); flex: 1; }
    .seniority-item.active .seniority-title { color: var(--accent); font-weight: 600; }
    .seniority-badge { font-size: 10px; padding: 4px 8px; background: var(--panel2); border-radius: 4px; color: var(--muted); }
    .seniority-item.active .seniority-badge { background: rgba(129, 140, 248, 0.2); color: var(--accent); }
    .hierarchy-list { display: flex; flex-direction: column; gap: 6px; flex: 1; }
    .hierarchy-item { display: flex; align-items: center; gap: 10px; padding: 10px 12px; background: var(--panel); border: 1px solid var(--border); border-radius: 8px; transition: all 0.2s ease; }
    .hierarchy-item:hover { border-color: var(--border-hover); }
    .hierarchy-item.active { border-color: var(--accent); background: rgba(129, 140, 248, 0.08); }
    .hierarchy-level { width: 28px; height: 28px; border-radius: 6px; background: var(--panel2); display: flex; align-items: center; justify-content: center; font-size: 11px; font-weight: 700; color: var(--muted); flex-shrink: 0; }
    .hierarchy-item.active .hierarchy-level { background: var(--accent); color: white; }
    .hierarchy-content { flex: 1; min-width: 0; }
    .hierarchy-title { font-size: 12px; font-weight: 500; color: var(--text); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .hierarchy-item.active .hierarchy-title { color: var(--accent); font-weight: 600; }
    .hierarchy-exp { font-size: 10px; color: var(--muted); margin-top: 2px; }
    .hierarchy-variants { font-size: 10px; color: var(--text-secondary); margin-top: 3px; line-height: 1.4; }

    /* Skill Analysis / Spider */
    .skill-analysis-content { flex: 1; display: flex; flex-direction: column; }
    .skill-view { display: none; flex-direction: column; flex: 1; }
    .skill-view.active { display: flex; }
    .spider-container { display: flex; justify-content: center; align-items: center; padding: 10px 20px 20px; flex: 1; }
    .spider-svg { max-width: 100%; height: auto; }
    .spider-legend { display: flex; flex-wrap: wrap; justify-content: center; gap: 16px; margin-top: 16px; padding-top: 16px; border-top: 1px solid var(--border); }
    .spider-legend-item { display: flex; align-items: center; gap: 8px; font-size: 12px; color: var(--text-secondary); }
    .spider-legend-dot { width: 10px; height: 10px; border-radius: 50%; }
    .spider-legend-dot.core { background: var(--accent); }
    .spider-legend-dot.supporting { background: var(--success); }
    .skills-list { display: flex; flex-direction: column; gap: 8px; flex: 1; }
    .skill-item { display: flex; align-items: center; justify-content: space-between; padding: 12px 16px; background: var(--panel2); border-radius: var(--radius-sm); border-left: 3px solid var(--accent); }
    .skill-item.supporting { border-left-color: var(--success); }
    .skill-name { font-size: 13px; font-weight: 500; color: var(--text); }
    .skill-level { font-size: 11px; padding: 4px 10px; border-radius: 999px; background: rgba(129, 140, 248, 0.15); color: var(--accent); font-weight: 500; }
    .skill-item.supporting .skill-level { background: rgba(16, 185, 129, 0.15); color: var(--success); }

    /* Activities Analysis */
    .activities-chart { display: flex; flex-direction: column; gap: 10px; }
    .activity-bar-item { display: flex; align-items: center; gap: 12px; }
    .activity-label { width: 140px; font-size: 12px; color: var(--text); font-weight: 500; text-align: right; flex-shrink: 0; }
    @media (max-width: 600px) { .activity-label { width: 100px; font-size: 11px; } }
    .activity-bar-container { flex: 1; height: 28px; background: var(--panel2); border-radius: 6px; overflow: hidden; position: relative; }
    .activity-bar { height: 100%; border-radius: 6px; display: flex; align-items: center; justify-content: flex-end; padding-right: 10px; transition: width 0.5s ease; }
    .activity-bar.high { background: linear-gradient(90deg, rgba(129, 140, 248, 0.3), rgba(129, 140, 248, 0.8)); }
    .activity-bar.medium { background: linear-gradient(90deg, rgba(16, 185, 129, 0.3), rgba(16, 185, 129, 0.7)); }
    .activity-bar.low { background: linear-gradient(90deg, rgba(245, 158, 11, 0.3), rgba(245, 158, 11, 0.6)); }
    .activity-percent { font-size: 11px; font-weight: 600; color: white; text-shadow: 0 1px 2px rgba(0,0,0,0.3); }
    .activities-legend { display: flex; flex-wrap: wrap; justify-content: center; gap: 20px; margin-top: 20px; padding-top: 16px; border-top: 1px solid var(--border); }
    .activities-legend-item { display: flex; align-items: center; gap: 8px; font-size: 12px; color: var(--text-secondary); }
    .activities-legend-bar { width: 24px; height: 10px; border-radius: 3px; }
    .activities-legend-bar.high { background: linear-gradient(90deg, rgba(129, 140, 248, 0.5), var(--accent)); }
    .activities-legend-bar.medium { background: linear-gradient(90deg, rgba(16, 185, 129, 0.5), var(--success)); }
    .activities-legend-bar.low { background: linear-gradient(90deg, rgba(245, 158, 11, 0.5), var(--warning)); }

    /* Cost Panel - Premium Financial Chart */
    .cost-panel { background: var(--panel); border: 1px solid var(--border); border-radius: var(--radius); overflow: hidden; }
    .cost-panel-header { padding: 20px 24px; border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 16px; }
    .cost-panel-title { font-size: 16px; font-weight: 600; }
    .cost-panel-subtitle { font-size: 12px; color: var(--muted); margin-top: 4px; }
    .cost-panel-body { padding: 0; }
    
    /* Region Selector - Refined */
    .region-selector { display: flex; flex-wrap: wrap; gap: 8px; padding: 16px 24px; background: var(--panel2); border-bottom: 1px solid var(--border); align-items: center; }
    .region-selector-label { font-size: 11px; color: var(--muted); text-transform: uppercase; letter-spacing: 1.2px; font-weight: 500; margin-right: 8px; }
    .region-chip { padding: 6px 14px; border: 1px solid var(--border); border-radius: 6px; background: var(--panel); color: var(--text-secondary); font-family: inherit; font-size: 11px; font-weight: 500; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; gap: 6px; }
    .region-chip:hover { border-color: var(--border-hover); color: var(--text); transform: translateY(-1px); }
    .region-chip.active { border-color: var(--region-color, var(--accent)); background: var(--region-bg, rgba(129, 140, 248, 0.1)); color: var(--text); box-shadow: 0 2px 8px var(--region-bg, rgba(129, 140, 248, 0.2)); }
    .region-chip .region-dot { width: 8px; height: 8px; border-radius: 50%; background: var(--region-color, var(--muted)); transition: all 0.2s; }
    .region-chip.active .region-dot { box-shadow: 0 0 8px var(--region-color, var(--accent)); }
    .region-chip[data-region="usa"] { --region-color: #ef4444; --region-bg: rgba(239, 68, 68, 0.1); }
    .region-chip[data-region="uk"] { --region-color: #818cf8; --region-bg: rgba(129, 140, 248, 0.1); }
    .region-chip[data-region="france"] { --region-color: #3b82f6; --region-bg: rgba(59, 130, 246, 0.1); }
    .region-chip[data-region="germany"] { --region-color: #f59e0b; --region-bg: rgba(245, 158, 11, 0.1); }
    .region-chip[data-region="poland"] { --region-color: #10b981; --region-bg: rgba(16, 185, 129, 0.1); }
    .region-chip[data-region="india"] { --region-color: #06b6d4; --region-bg: rgba(6, 182, 212, 0.1); }
    .region-chip[data-region="philippines"] { --region-color: #ec4899; --region-bg: rgba(236, 72, 153, 0.1); }
    .region-chip[data-region="all"] { --region-color: #94a3b8; --region-bg: rgba(148, 163, 184, 0.1); }
    .region-chip.all-btn { font-weight: 600; }
    
    /* ================================================
       PROFESSIONAL CHART - TradingView Inspired
       ================================================ */
    
    /* Chart Container */
    .chart-wrapper { position: relative; padding: 20px 24px 0; }
    .chart-container { 
      position: relative; 
      width: 100%; 
      height: 520px; 
      background: linear-gradient(180deg, var(--panel) 0%, var(--panel2) 100%);
      border-radius: 12px;
      overflow: hidden;
      cursor: crosshair;
    }
    .chart-canvas { 
      width: 100%; 
      height: 100%; 
      display: block;
    }
    
    /* Crosshair - TradingView Style */
    .chart-crosshair { 
      position: absolute; 
      pointer-events: none; 
      z-index: 10;
      will-change: transform;
    }
    .chart-crosshair-h { 
      position: absolute; 
      height: 1px; 
      left: 0;
      right: 0;
      background: var(--accent);
      opacity: 0.6;
    }
    .chart-crosshair-v { 
      position: absolute; 
      width: 1px; 
      top: 0; 
      bottom: 0;
      background: var(--accent);
      opacity: 0.6;
    }
    .chart-crosshair-label { 
      position: absolute; 
      background: var(--accent); 
      color: white; 
      font-size: 11px; 
      font-weight: 600; 
      font-family: 'JetBrains Mono', monospace;
      padding: 4px 10px; 
      border-radius: 4px; 
      white-space: nowrap;
      box-shadow: 0 2px 8px rgba(0,0,0,0.3);
    }
    .chart-crosshair-label.y-label { 
      right: 8px; 
      transform: translateY(-50%);
    }
    .chart-crosshair-label.x-label { 
      bottom: 8px; 
      transform: translateX(-50%);
    }
    
    /* Floating Tooltip - Premium Design */
    .chart-tooltip { 
      position: absolute; 
      background: var(--panel); 
      border: 1px solid var(--border2);
      border-radius: 12px;
      padding: 0;
      font-size: 12px; 
      box-shadow: 0 12px 48px rgba(0,0,0,0.4), 0 4px 16px rgba(0,0,0,0.2);
      pointer-events: none; 
      z-index: 100; 
      opacity: 0;
      transform: translateY(8px) scale(0.96);
      transition: opacity 0.2s ease, transform 0.2s ease;
      min-width: 260px;
      backdrop-filter: blur(16px);
      overflow: hidden;
    }
    .chart-tooltip.visible { 
      opacity: 1;
      transform: translateY(0) scale(1);
    }
    .chart-tooltip-header { 
      display: flex; 
      align-items: center; 
      justify-content: space-between;
      gap: 12px;
      padding: 14px 18px;
      background: var(--panel2);
      border-bottom: 1px solid var(--border);
    }
    .chart-tooltip-channel { 
      font-weight: 700; 
      font-size: 15px; 
      color: var(--text);
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .chart-tooltip-channel::before {
      content: '';
      width: 4px;
      height: 20px;
      border-radius: 2px;
      background: var(--tooltip-accent, var(--accent));
    }
    .chart-tooltip-badge { 
      font-size: 9px; 
      padding: 4px 10px; 
      background: rgba(129, 140, 248, 0.15);
      color: var(--accent);
      border-radius: 6px; 
      text-transform: uppercase; 
      letter-spacing: 0.8px;
      font-weight: 600;
    }
    .chart-tooltip-body {
      padding: 16px 18px;
    }
    .chart-tooltip-stats { 
      display: grid; 
      grid-template-columns: repeat(2, 1fr); 
      gap: 12px;
    }
    .chart-tooltip-stat { 
      display: flex; 
      flex-direction: column; 
      gap: 4px;
      padding: 10px 12px;
      background: var(--panel2);
      border-radius: 8px;
      border: 1px solid var(--border);
    }
    .chart-tooltip-stat-label { 
      font-size: 9px; 
      color: var(--muted); 
      text-transform: uppercase; 
      letter-spacing: 0.8px;
      font-weight: 500;
    }
    .chart-tooltip-stat-value { 
      font-size: 16px; 
      font-weight: 700; 
      color: var(--text); 
      font-family: 'JetBrains Mono', monospace;
    }
    .chart-tooltip-stat-value.high { color: #10b981; }
    .chart-tooltip-stat-value.median { color: var(--accent); }
    .chart-tooltip-stat-value.low { color: #f59e0b; }
    .chart-tooltip-regions { 
      margin-top: 16px;
      padding-top: 14px;
      border-top: 1px solid var(--border);
      display: flex; 
      flex-direction: column; 
      gap: 8px;
    }
    .chart-tooltip-regions-title {
      font-size: 9px;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 0.8px;
      font-weight: 500;
      margin-bottom: 4px;
    }
    .chart-tooltip-region-row { 
      display: flex; 
      align-items: center; 
      gap: 10px;
      padding: 6px 0;
    }
    .chart-tooltip-region-dot { 
      width: 10px; 
      height: 10px; 
      border-radius: 50%; 
      flex-shrink: 0;
      box-shadow: 0 0 8px currentColor;
    }
    .chart-tooltip-region-name { 
      flex: 1; 
      font-size: 12px; 
      color: var(--text-secondary);
    }
    .chart-tooltip-region-value { 
      font-size: 13px; 
      font-weight: 700; 
      color: var(--text); 
      font-family: 'JetBrains Mono', monospace;
    }
    
    /* Chart Legend - Refined */
    .chart-legend { 
      display: flex; 
      justify-content: center; 
      gap: 40px; 
      padding: 18px 24px; 
      border-top: 1px solid var(--border); 
      background: var(--panel2);
    }
    .chart-legend-item { 
      display: flex; 
      align-items: center; 
      gap: 12px; 
      font-size: 12px; 
      color: var(--text-secondary);
    }
    .chart-legend-icon { 
      display: flex; 
      align-items: center; 
      gap: 1px;
    }
    .chart-legend-wick { 
      width: 2px; 
      height: 8px; 
      background: var(--text-secondary); 
      border-radius: 1px;
    }
    .chart-legend-body { 
      width: 16px; 
      height: 28px; 
      border-radius: 4px; 
      background: linear-gradient(180deg, var(--accent) 0%, rgba(129, 140, 248, 0.3) 100%);
      border: 2px solid var(--accent);
      margin: 0 -7px;
    }
    .chart-legend-line { 
      width: 24px; 
      height: 3px; 
      background: var(--text); 
      border-radius: 2px;
    }
    
    /* Data Table - Premium */
    .chart-data-table { 
      margin: 0 24px 24px; 
      border: 1px solid var(--border); 
      border-radius: var(--radius-sm); 
      overflow: hidden;
    }
    .chart-data-table table { 
      width: 100%; 
      border-collapse: collapse; 
      font-size: 13px;
    }
    .chart-data-table th { 
      background: var(--panel2); 
      padding: 14px 18px; 
      text-align: left; 
      font-weight: 600; 
      color: var(--text); 
      border-bottom: 1px solid var(--border); 
      font-size: 11px; 
      text-transform: uppercase; 
      letter-spacing: 0.5px;
    }
    .chart-data-table td { 
      padding: 14px 18px; 
      border-bottom: 1px solid var(--border); 
      color: var(--text-secondary); 
      transition: background 0.15s;
    }
    .chart-data-table tr:last-child td { border-bottom: none; }
    .chart-data-table tr:hover td { background: rgba(129, 140, 248, 0.05); }
    .chart-data-table .region-indicator { 
      display: inline-flex; 
      align-items: center; 
      gap: 10px;
      font-weight: 500;
      color: var(--text);
    }
    .chart-data-table .region-dot { 
      width: 10px; 
      height: 10px; 
      border-radius: 50%;
    }
    .chart-data-table .rate-range { 
      font-family: 'JetBrains Mono', monospace; 
      font-size: 12px;
    }
    .chart-data-table .rate-median { 
      color: var(--accent); 
      font-weight: 700;
    }
    
    /* Sources */
    .chart-sources { 
      padding: 18px 24px; 
      display: flex; 
      gap: 28px; 
      flex-wrap: wrap; 
      justify-content: center; 
      border-top: 1px solid var(--border);
      background: var(--panel);
    }
    .chart-source { 
      font-size: 11px; 
      color: var(--muted); 
      display: flex; 
      align-items: center; 
      gap: 8px;
    }
    .chart-source svg { 
      width: 14px; 
      height: 14px; 
      opacity: 0.5;
    }

    /* AI */
    .ai-task-list { display: flex; flex-direction: column; gap: 10px; }
    .ai-task-item { display: flex; align-items: center; justify-content: space-between; padding: 12px 16px; background: var(--panel2); border-radius: var(--radius-sm); }
    .ai-task-name { font-size: 13px; color: var(--text); }
    .ai-task-badge { padding: 5px 10px; border-radius: 6px; font-size: 10px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; }
    .ai-task-badge.automatable { background: rgba(16, 185, 129, 0.15); color: var(--success); }
    .ai-task-badge.augmentable { background: rgba(245, 158, 11, 0.15); color: var(--warning); }
    .ai-task-badge.human-led { background: rgba(248, 113, 113, 0.15); color: var(--coral); }
    .ai-signal { margin-top: 16px; padding: 14px; background: var(--panel2); border-radius: var(--radius-sm); border-left: 3px solid var(--accent); }
    .ai-signal-label { font-size: 10px; color: var(--muted); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 6px; }
    .ai-signal-text { font-size: 13px; color: var(--text-secondary); font-style: italic; }

    /* Deep Dive */
    .deep-dive-container { max-width: 700px; margin: 0 auto; padding: 40px 20px; }
    .deep-dive-header { margin-bottom: 32px; }
    .deep-dive-title { font-size: 24px; font-weight: 700; margin-bottom: 8px; }
    .deep-dive-subtitle { color: var(--text-secondary); font-size: 14px; }
    .deep-dive-progress { display: flex; align-items: center; gap: 8px; margin-bottom: 32px; }
    .progress-step { flex: 1; height: 4px; background: var(--border); border-radius: 2px; transition: all 0.3s; }
    .progress-step.active { background: var(--accent); }
    .progress-step.completed { background: var(--success); }
    .deep-dive-question { background: var(--panel); border: 1px solid var(--border); border-radius: var(--radius); padding: 28px; margin-bottom: 24px; }
    .question-number { font-family: 'JetBrains Mono', monospace; font-size: 11px; color: var(--accent); margin-bottom: 12px; }
    .question-text { font-size: 18px; font-weight: 600; margin-bottom: 20px; line-height: 1.4; }
    .question-options { display: flex; flex-direction: column; gap: 10px; }
    .question-option { padding: 16px 20px; border: 1px solid var(--border); border-radius: var(--radius-sm); background: transparent; color: var(--text-secondary); font-family: inherit; font-size: 14px; cursor: pointer; transition: all 0.2s; text-align: left; }
    .question-option:hover { border-color: var(--accent); color: var(--text); background: rgba(129, 140, 248, 0.05); }
    .question-option.selected { border-color: var(--accent); background: rgba(129, 140, 248, 0.1); color: var(--text); }
    .deep-dive-nav { display: flex; justify-content: space-between; gap: 16px; }
    .btn-back { padding: 12px 24px; border: 1px solid var(--border); background: transparent; color: var(--text-secondary); font-family: inherit; font-size: 14px; border-radius: var(--radius-sm); cursor: pointer; transition: all 0.2s; }
    .btn-back:hover { border-color: var(--border-hover); color: var(--text); }
    .btn-next { padding: 12px 24px; border: none; background: var(--accent); color: white; font-family: inherit; font-size: 14px; font-weight: 500; border-radius: var(--radius-sm); cursor: pointer; transition: all 0.2s; }
    .btn-next:hover { filter: brightness(1.1); }
    .btn-next:disabled { opacity: 0.5; cursor: not-allowed; }

    /* Modal */
    .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.7); backdrop-filter: blur(4px); display: none; align-items: center; justify-content: center; z-index: 1000; padding: 20px; }
    .modal-overlay.active { display: flex; }
    .modal { background: var(--panel); border: 1px solid var(--border); border-radius: var(--radius); padding: 32px; max-width: 560px; width: 100%; box-shadow: var(--shadow); animation: modal-in 0.3s ease; position: relative; max-height: 90vh; overflow-y: auto; }
    @keyframes modal-in { from { opacity: 0; transform: scale(0.95) translateY(10px); } to { opacity: 1; transform: scale(1) translateY(0); } }
    .modal-close { position: absolute; top: 16px; right: 16px; width: 36px; height: 36px; border: none; background: transparent; color: var(--muted); cursor: pointer; border-radius: 8px; display: flex; align-items: center; justify-content: center; transition: all 0.2s ease; }
    .modal-close:hover { background: var(--panel2); color: var(--text); }
    .modal-icon { width: 56px; height: 56px; border-radius: 14px; background: rgba(16, 185, 129, 0.1); display: flex; align-items: center; justify-content: center; margin-bottom: 20px; }
    .modal-icon svg { width: 28px; height: 28px; color: var(--success); }
    .modal h2 { font-size: 22px; font-weight: 600; margin-bottom: 8px; }
    .modal-subtitle { color: var(--text-secondary); font-size: 14px; line-height: 1.6; margin-bottom: 28px; }
    .upload-section { margin-bottom: 16px; }
    .upload-label { font-size: 13px; font-weight: 500; color: var(--text); margin-bottom: 8px; display: block; }
    .upload-area { border: 2px dashed var(--border); border-radius: var(--radius-sm); padding: 20px; text-align: center; cursor: pointer; transition: all 0.2s; }
    .upload-area:hover { border-color: var(--accent); background: rgba(129, 140, 248, 0.05); }
    .upload-area-icon { width: 36px; height: 36px; margin: 0 auto 10px; background: var(--panel2); border-radius: 8px; display: flex; align-items: center; justify-content: center; }
    .upload-area-icon svg { width: 18px; height: 18px; color: var(--muted); }
    .upload-area-text { font-size: 12px; color: var(--text-secondary); }
    .upload-area-hint { font-size: 10px; color: var(--muted); margin-top: 4px; }
    .coming-soon-badge { display: inline-flex; align-items: center; gap: 6px; padding: 6px 12px; background: rgba(245, 158, 11, 0.1); border: 1px solid rgba(245, 158, 11, 0.3); border-radius: 999px; font-size: 11px; color: var(--warning); font-weight: 500; margin-top: 20px; }

    /* Upload Document Button */
    .input-with-upload { display: flex; gap: 12px; align-items: stretch; }
    .input-with-upload .typeahead-container { flex: 1; }
    .btn-upload-doc { display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 6px; padding: 12px 20px; border: 2px dashed var(--border); border-radius: var(--radius-sm); background: transparent; color: var(--muted); font-family: inherit; font-size: 12px; font-weight: 500; cursor: pointer; transition: all 0.2s ease; min-width: 120px; }
    .btn-upload-doc:hover { border-color: var(--accent); color: var(--accent); background: rgba(129, 140, 248, 0.05); }
    .btn-upload-doc svg { width: 24px; height: 24px; }
    .or-divider { display: flex; align-items: center; color: var(--muted); font-size: 12px; padding: 0 4px; }

    /* Upload Modal Specific */
    .upload-modal { max-width: 640px; }
    .upload-modal-header { text-align: center; margin-bottom: 28px; }
    .upload-modal-badge { font-size: 28px; margin-bottom: 12px; }
    .upload-modal-title { font-size: 14px; font-weight: 600; color: var(--warning); text-transform: uppercase; letter-spacing: 2px; }
    .upload-dropzone { border: 2px dashed var(--border); border-radius: var(--radius); padding: 40px 24px; text-align: center; cursor: pointer; transition: all 0.2s ease; margin-bottom: 28px; background: var(--panel2); }
    .upload-dropzone:hover { border-color: var(--accent); background: rgba(129, 140, 248, 0.05); }
    .upload-dropzone.dragover { border-color: var(--accent); background: rgba(129, 140, 248, 0.1); }
    .upload-dropzone-icon { width: 56px; height: 56px; margin: 0 auto 16px; background: rgba(129, 140, 248, 0.1); border-radius: 14px; display: flex; align-items: center; justify-content: center; }
    .upload-dropzone-icon svg { width: 28px; height: 28px; color: var(--accent); }
    .upload-dropzone-text { font-size: 16px; font-weight: 500; color: var(--text); margin-bottom: 6px; }
    .upload-dropzone-hint { font-size: 13px; color: var(--muted); }
    .upload-dropzone-hint span { color: var(--accent); cursor: pointer; }
    .upload-types { display: flex; flex-direction: column; gap: 16px; }
    .upload-type-card { background: var(--panel2); border: 1px solid var(--border); border-radius: var(--radius-sm); padding: 20px; transition: all 0.2s ease; }
    .upload-type-card:hover { border-color: var(--border-hover); }
    .upload-type-header { display: flex; align-items: center; gap: 12px; margin-bottom: 10px; }
    .upload-type-icon { width: 40px; height: 40px; border-radius: 10px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
    .upload-type-icon.blue { background: rgba(59, 130, 246, 0.15); color: #3b82f6; }
    .upload-type-icon.purple { background: rgba(168, 85, 247, 0.15); color: #a855f7; }
    .upload-type-icon svg { width: 20px; height: 20px; }
    .upload-type-title { font-size: 15px; font-weight: 600; color: var(--text); }
    .upload-type-desc { font-size: 13px; color: var(--text-secondary); line-height: 1.6; }

    footer { margin-top: 48px; padding: 24px 0; border-top: 1px solid var(--border); display: flex; flex-wrap: wrap; justify-content: space-between; align-items: center; gap: 16px; font-size: 13px; color: var(--muted); }
    footer a { color: var(--text-secondary); transition: color 0.2s ease; text-decoration: none; }
    footer a:hover { color: var(--accent); }
    .footer-links { display: flex; gap: 16px; }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand"><div class="logo"></div><h1>triangulate.dev</h1></div>
      <div class="header-actions">
        <button class="theme-toggle" id="themeToggle" aria-label="Toggle theme">
          <svg class="moon-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
          <svg class="sun-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
        </button>
        <button class="btn-ghost" onclick="resetToEntry()">New Query</button>
      </div>
    </header>

    <!-- ENTRY SCREEN -->
    <section id="entryScreen" class="screen active">
      <div class="entry-container">
        <div class="entry-header">
          <div class="badge">Workforce Intelligence Platform</div>
          <h2 class="title">Understand your workforce needs from any starting point</h2>
          <p class="subtitle">Describe a role, skill, outcome, problem, or job you need completed. We interpret your needs and deliver structured workforce intelligence.</p>
          
          <!-- DATA SOURCES VERIFICATION BUTTON -->
          <a href="data-sources.html" class="data-sources-link">
            <span class="verified-icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><polyline points="20 6 9 17 4 12"/></svg>
            </span>
            <span>Verified against 100+ data sources and repositories</span>
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
          </a>
        </div>
        <div class="helper-box">
          <div class="helper-title"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4M12 8h.01"/></svg>Work starts from different beginnings</div>
          <div class="helper-text">People think about work differently. Hiring managers think in job titles. Technologists think in skills. Executives think in outcomes. Finance thinks in costs. We normalize all of them into one canonical model.</div>
          <div class="helper-paths">
            <span class="helper-path"><span class="helper-path-icon t">T</span> Title-led</span>
            <span class="helper-path"><span class="helper-path-icon s">S</span> Skill-led</span>
            <span class="helper-path"><span class="helper-path-icon j">J</span> Job-to-be-done</span>
            <span class="helper-path"><span class="helper-path-icon o">O</span> Outcome-led</span>
            <span class="helper-path"><span class="helper-path-icon p">P</span> Problem-led</span>
          </div>
        </div>
        <div class="entry-inputs-container">
          <div class="entry-card">
            <div class="entry-card-header"><div class="entry-card-num">1</div><div class="entry-card-label">So... what do you need?</div></div>
            <div class="input-with-upload">
              <div class="typeahead-container">
                <input type="text" class="entry-input" id="inputTask" placeholder="e.g. a job, a skill, a thing or an outcome" autocomplete="off"/>
                <div class="typeahead-dropdown" id="typeaheadDropdown"></div>
              </div>
              <div class="or-divider">or</div>
              <button class="btn-upload-doc" onclick="openUploadModal()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
                Upload
              </button>
            </div>
          </div>
          <div class="entry-card">
            <div class="entry-card-header"><div class="entry-card-num">2</div><div class="entry-card-label">Add some context on what you need? <span class="optional">(optional)</span></div></div>
            <textarea class="entry-input textarea" id="inputProblem" placeholder="e.g., Our CRM implementation is 6 months behind schedule and we're losing deals due to poor customer data quality..."></textarea>
          </div>
        </div>
        <div class="entry-actions">
          <button class="btn-analyze" onclick="submitQuery()"><span>Analyze Requirements</span><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"/></svg></button>
        </div>
        <div class="examples-section">
          <div class="examples-label">Try an example</div>
          <div class="examples-grid">
            <button class="example-chip" onclick="setExample('Senior data engineer for our ML pipeline', '')">Data Engineer</button>
            <button class="example-chip" onclick="setExample('I need to reduce our contractor spend by 20%', 'We have 200+ contractors across 15 vendors with no visibility into rates')">Cost Reduction</button>
            <button class="example-chip" onclick="setExample('Python, AWS, Kubernetes skills for DevOps', '')">Skills-based</button>
            <button class="example-chip" onclick="setExample('Transform our customer onboarding process', 'Customer churn at 90 days is 40% and NPS dropped from 45 to 28')">Transformation</button>
          </div>
        </div>
        <!-- INFO CARDS AT BOTTOM -->
        <div class="info-cards-row">
          <div class="info-card">
            <div class="info-card-icon purple"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg></div>
            <div class="info-card-title">Single mental model</div>
            <div class="info-card-desc">No tabs, no forced taxonomy. Enter naturally and we interpret your intent.</div>
          </div>
          <div class="info-card">
            <div class="info-card-icon green"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg></div>
            <div class="info-card-title">Canonical output</div>
            <div class="info-card-desc">Every input converges to one Work Summary: roles, skills, costs, and delivery options.</div>
          </div>
          <div class="info-card">
            <div class="info-card-icon orange"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/><polyline points="3.27 6.96 12 12.01 20.73 6.96"/><line x1="12" y1="22.08" x2="12" y2="12"/></svg></div>
            <div class="info-card-title">Data-driven</div>
            <div class="info-card-desc">Powered by GICS classifications, ILO labour costs, OECD productivity data, and Deployed taxonomies.</div>
          </div>
          <div class="info-card">
            <div class="info-card-icon coral"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><line x1="3" y1="9" x2="21" y2="9"/><line x1="9" y1="21" x2="9" y2="9"/></svg></div>
            <div class="info-card-title">AI suitability</div>
            <div class="info-card-desc">Understand which tasks can be automated vs. augmented vs. human-led.</div>
          </div>
        </div>
      </div>
    </section>

    <!-- INTERPRETING SCREEN -->
    <section id="interpretingScreen" class="screen">
      <div class="interpreting-container">
        <div class="interpreting-header"><div class="spinner"></div><span class="interpreting-title">Interpreting your request…</span></div>
        <div class="detected-card"><div class="detected-label">Detected Intent</div><div class="detected-items" id="detectedItems"></div></div>
        <div class="clarification-card"><div class="clarification-question" id="clarificationQuestion">One quick question to clarify scope:</div><div class="clarification-options" id="clarificationOptions"></div><div class="clarification-note">(this dynamic second question changes based on your request)</div></div>
      </div>
    </section>

    <!-- WORKSPACE SCREEN -->
    <section id="workspaceScreen" class="screen">
      <div class="workspace-header">
        <div class="workspace-breadcrumb">Work Summary</div>
        <div class="workspace-title-row">
          <div><h2 class="workspace-title" id="workspaceTitle">Project delivery leadership for CRM migration</h2><p class="workspace-subtitle" id="workspaceSubtitle">Entry lens: Job title + Job-to-be-done</p></div>
          <div class="workspace-actions">
            <button class="btn-deep-dive" onclick="openDeepDive()"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/></svg>Deep dive</button>
          </div>
        </div>
      </div>
      <div class="panel" style="margin-bottom: 20px;">
        <div class="panel-header"><span class="panel-title">Interpreted Need</span></div>
        <div class="panel-body"><p id="interpretedNeed" style="color: var(--text-secondary); line-height: 1.6;">You need a mid-to-senior level professional who can lead the delivery of a CRM migration project, coordinating cross-functional teams, managing timelines, and ensuring stakeholder alignment throughout the transformation.</p></div>
      </div>
      <div class="panels-grid">
        <div class="panel">
          <div class="panel-header"><span class="panel-title">Job Analysis</span></div>
          <div class="panel-body">
            <div class="analysis-definition">A job is defined as a collection or aggregation of tasks, duties, and responsibilities assigned to an individual.</div>
            <div class="job-analysis-container">
              <div class="job-section">
                <div class="job-section-title"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 20V10M18 20V4M6 20v-4"/></svg>Job Seniority</div>
                <div class="seniority-list">
                  <div class="seniority-item distant"><span class="seniority-title">Principal Project Manager</span><span class="seniority-badge">L6</span></div>
                  <div class="seniority-arrow">▲</div>
                  <div class="seniority-item adjacent"><span class="seniority-title">Lead Project Manager</span><span class="seniority-badge">L5</span></div>
                  <div class="seniority-arrow">▲</div>
                  <div class="seniority-item active"><span class="seniority-title">Senior Project Manager</span><span class="seniority-badge">L4</span></div>
                  <div class="seniority-arrow">▼</div>
                  <div class="seniority-item adjacent"><span class="seniority-title">Project Manager</span><span class="seniority-badge">L3</span></div>
                  <div class="seniority-arrow">▼</div>
                  <div class="seniority-item distant"><span class="seniority-title">Junior Project Manager</span><span class="seniority-badge">L2</span></div>
                  <div class="seniority-arrow">▼</div>
                  <div class="seniority-item distant"><span class="seniority-title">Associate Project Manager</span><span class="seniority-badge">L1</span></div>
                </div>
              </div>
              <div class="job-section">
                <div class="job-section-title"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87M16 3.13a4 4 0 0 1 0 7.75"/></svg>Job Hierarchy</div>
                <div class="hierarchy-list">
                  <div class="hierarchy-item"><div class="hierarchy-level">7</div><div class="hierarchy-content"><div class="hierarchy-title">C-Suite / President</div><div class="hierarchy-variants">Board Member / CEO / CXO</div></div></div>
                  <div class="hierarchy-item"><div class="hierarchy-level">6</div><div class="hierarchy-content"><div class="hierarchy-title">SVP / Executive VP</div><div class="hierarchy-variants">Managing Director / Head of Region</div></div></div>
                  <div class="hierarchy-item"><div class="hierarchy-level">5</div><div class="hierarchy-content"><div class="hierarchy-title">Vice President (VP)</div><div class="hierarchy-variants">Senior Director / VP</div></div></div>
                  <div class="hierarchy-item active"><div class="hierarchy-level">4</div><div class="hierarchy-content"><div class="hierarchy-title">Director / Sr Director</div><div class="hierarchy-variants">Associate Director / Director</div></div></div>
                  <div class="hierarchy-item"><div class="hierarchy-level">3</div><div class="hierarchy-content"><div class="hierarchy-title">Senior Manager</div><div class="hierarchy-variants">Senior Manager / Head of Dept</div></div></div>
                  <div class="hierarchy-item"><div class="hierarchy-level">2</div><div class="hierarchy-content"><div class="hierarchy-title">Sr Associate / Manager</div><div class="hierarchy-variants">Assistant Manager / Manager</div></div></div>
                  <div class="hierarchy-item"><div class="hierarchy-level">1</div><div class="hierarchy-content"><div class="hierarchy-title">Associate / Specialist</div><div class="hierarchy-variants">Executive / Graduate Trainee</div></div></div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="panel">
          <div class="panel-header">
            <span class="panel-title">Skill Analysis</span>
            <div class="panel-toggle" id="skillsToggle">
              <button class="panel-toggle-btn active" data-view="diagram">Diagram</button>
              <button class="panel-toggle-btn" data-view="list">List</button>
            </div>
          </div>
          <div class="panel-body">
            <div class="analysis-definition">A skill is a learned ability, proficiency, or expertise needed to perform specific tasks or activities effectively.</div>
            <div class="skill-analysis-content">
              <div class="skill-view active" id="skillDiagramView">
                <div class="spider-container">
                  <svg class="spider-svg" width="320" height="320" viewBox="0 0 320 320">
                    <defs>
                      <linearGradient id="coreGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:#818cf8;stop-opacity:0.3"/>
                        <stop offset="100%" style="stop-color:#a78bfa;stop-opacity:0.1"/>
                      </linearGradient>
                    </defs>
                    <g transform="translate(160,160)">
                      <polygon points="0,-100 86.6,-50 86.6,50 0,100 -86.6,50 -86.6,-50" fill="none" stroke="rgba(255,255,255,0.06)" stroke-width="1"/>
                      <polygon points="0,-75 65,-37.5 65,37.5 0,75 -65,37.5 -65,-37.5" fill="none" stroke="rgba(255,255,255,0.06)" stroke-width="1"/>
                      <polygon points="0,-50 43.3,-25 43.3,25 0,50 -43.3,25 -43.3,-25" fill="none" stroke="rgba(255,255,255,0.06)" stroke-width="1"/>
                      <polygon points="0,-25 21.7,-12.5 21.7,12.5 0,25 -21.7,12.5 -21.7,-12.5" fill="none" stroke="rgba(255,255,255,0.06)" stroke-width="1"/>
                      <line x1="0" y1="0" x2="0" y2="-100" stroke="rgba(255,255,255,0.06)"/>
                      <line x1="0" y1="0" x2="86.6" y2="-50" stroke="rgba(255,255,255,0.06)"/>
                      <line x1="0" y1="0" x2="86.6" y2="50" stroke="rgba(255,255,255,0.06)"/>
                      <line x1="0" y1="0" x2="0" y2="100" stroke="rgba(255,255,255,0.06)"/>
                      <line x1="0" y1="0" x2="-86.6" y2="50" stroke="rgba(255,255,255,0.06)"/>
                      <line x1="0" y1="0" x2="-86.6" y2="-50" stroke="rgba(255,255,255,0.06)"/>
                      <polygon points="0,-85 69.3,-35 60.6,40 0,70 -52,35 -52,-40" fill="url(#coreGrad)" stroke="#818cf8" stroke-width="2"/>
                      <circle cx="0" cy="-85" r="5" fill="#818cf8"/>
                      <circle cx="69.3" cy="-35" r="5" fill="#818cf8"/>
                      <circle cx="60.6" cy="40" r="5" fill="#818cf8"/>
                      <circle cx="0" cy="70" r="5" fill="#818cf8"/>
                      <circle cx="-52" cy="35" r="5" fill="#10b981"/>
                      <circle cx="-52" cy="-40" r="5" fill="#10b981"/>
                      <text y="-115" text-anchor="middle" fill="#a0a0b0" font-size="11" font-weight="500">Planning</text>
                      <text x="105" y="-40" text-anchor="start" fill="#a0a0b0" font-size="11" font-weight="500">Stakeholder</text>
                      <text x="105" y="-28" text-anchor="start" fill="#a0a0b0" font-size="10">Management</text>
                      <text x="105" y="50" text-anchor="start" fill="#a0a0b0" font-size="11" font-weight="500">Risk</text>
                      <text x="105" y="62" text-anchor="start" fill="#a0a0b0" font-size="10">Management</text>
                      <text y="125" text-anchor="middle" fill="#a0a0b0" font-size="11" font-weight="500">Communication</text>
                      <text x="-105" y="50" text-anchor="end" fill="#10b981" font-size="11" font-weight="500">Agile/Scrum</text>
                      <text x="-105" y="-40" text-anchor="end" fill="#10b981" font-size="11" font-weight="500">CRM Systems</text>
                    </g>
                  </svg>
                </div>
                <div class="spider-legend">
                  <div class="spider-legend-item"><div class="spider-legend-dot core"></div>Core skills required</div>
                  <div class="spider-legend-item"><div class="spider-legend-dot supporting"></div>Supporting skills</div>
                </div>
              </div>
              <div class="skill-view" id="skillListView">
                <div class="skills-list">
                  <div class="skill-item core"><span class="skill-name">Project Planning</span><span class="skill-level">Expert</span></div>
                  <div class="skill-item core"><span class="skill-name">Stakeholder Management</span><span class="skill-level">Expert</span></div>
                  <div class="skill-item core"><span class="skill-name">Risk Management</span><span class="skill-level">Advanced</span></div>
                  <div class="skill-item core"><span class="skill-name">Communication</span><span class="skill-level">Expert</span></div>
                  <div class="skill-item supporting"><span class="skill-name">Agile/Scrum</span><span class="skill-level">Intermediate</span></div>
                  <div class="skill-item supporting"><span class="skill-name">CRM Systems</span><span class="skill-level">Intermediate</span></div>
                </div>
                <div class="spider-legend" style="margin-top: auto;">
                  <div class="spider-legend-item"><div class="spider-legend-dot core"></div>Core skills</div>
                  <div class="spider-legend-item"><div class="spider-legend-dot supporting"></div>Supporting skills</div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="panel full-width">
          <div class="panel-header"><span class="panel-title">Activity Analysis</span></div>
          <div class="panel-body">
            <div class="analysis-definition">An activity is a specific, discrete action, task, or responsibility that makes up a job.</div>
            <div class="activities-chart">
              <div class="activity-bar-item"><div class="activity-label">Stakeholder Communication</div><div class="activity-bar-container"><div class="activity-bar high" style="width: 92%;"><span class="activity-percent">92%</span></div></div></div>
              <div class="activity-bar-item"><div class="activity-label">Project Planning</div><div class="activity-bar-container"><div class="activity-bar high" style="width: 88%;"><span class="activity-percent">88%</span></div></div></div>
              <div class="activity-bar-item"><div class="activity-label">Risk Assessment</div><div class="activity-bar-container"><div class="activity-bar high" style="width: 82%;"><span class="activity-percent">82%</span></div></div></div>
              <div class="activity-bar-item"><div class="activity-label">Resource Coordination</div><div class="activity-bar-container"><div class="activity-bar medium" style="width: 75%;"><span class="activity-percent">75%</span></div></div></div>
              <div class="activity-bar-item"><div class="activity-label">Status Reporting</div><div class="activity-bar-container"><div class="activity-bar medium" style="width: 70%;"><span class="activity-percent">70%</span></div></div></div>
              <div class="activity-bar-item"><div class="activity-label">Budget Management</div><div class="activity-bar-container"><div class="activity-bar medium" style="width: 65%;"><span class="activity-percent">65%</span></div></div></div>
              <div class="activity-bar-item"><div class="activity-label">Vendor Management</div><div class="activity-bar-container"><div class="activity-bar low" style="width: 55%;"><span class="activity-percent">55%</span></div></div></div>
              <div class="activity-bar-item"><div class="activity-label">Technical Review</div><div class="activity-bar-container"><div class="activity-bar low" style="width: 45%;"><span class="activity-percent">45%</span></div></div></div>
            </div>
            <div class="activities-legend">
              <div class="activities-legend-item"><div class="activities-legend-bar high"></div>High frequency (>75%)</div>
              <div class="activities-legend-item"><div class="activities-legend-bar medium"></div>Medium frequency (50–75%)</div>
              <div class="activities-legend-item"><div class="activities-legend-bar low"></div>Lower frequency (<50%)</div>
            </div>
          </div>
        </div>
        <div class="panel full-width" id="costChartPanel">
          <div class="cost-panel-header"><div><div class="cost-panel-title">Cost by Fulfilment Channel</div><div class="cost-panel-subtitle">Daily rate ranges (10th–90th percentile) • USD • v7</div></div></div>
          <div class="cost-panel-body">
            <div class="region-selector">
              <div class="region-selector-label">Regions</div>
              <button class="region-chip active" data-region="usa" onclick="toggleRegion(this)"><span class="region-dot"></span>USA</button>
              <button class="region-chip" data-region="uk" onclick="toggleRegion(this)"><span class="region-dot"></span>UK</button>
              <button class="region-chip" data-region="france" onclick="toggleRegion(this)"><span class="region-dot"></span>France</button>
              <button class="region-chip" data-region="germany" onclick="toggleRegion(this)"><span class="region-dot"></span>Germany</button>
              <button class="region-chip" data-region="poland" onclick="toggleRegion(this)"><span class="region-dot"></span>Poland</button>
              <button class="region-chip" data-region="india" onclick="toggleRegion(this)"><span class="region-dot"></span>India</button>
              <button class="region-chip" data-region="philippines" onclick="toggleRegion(this)"><span class="region-dot"></span>Philippines</button>
              <span style="border-left: 1px solid var(--border); height: 24px; margin: 0 8px;"></span>
              <button class="region-chip all-btn" data-region="all" onclick="toggleAllRegions(this)"><span class="region-dot"></span>All</button>
            </div>
            <div class="chart-wrapper">
              <div class="chart-container" id="chartContainer">
                <canvas class="chart-canvas" id="chartCanvas"></canvas>
                <!-- Crosshair overlay -->
                <div class="chart-crosshair" id="chartCrosshair" style="display: none;">
                  <div class="chart-crosshair-h" id="crosshairH"></div>
                  <div class="chart-crosshair-v" id="crosshairV"></div>
                  <div class="chart-crosshair-label y-label" id="crosshairYLabel">$1,200</div>
                  <div class="chart-crosshair-label x-label" id="crosshairXLabel">Permanent</div>
                </div>
                <!-- Floating tooltip -->
                <div class="chart-tooltip" id="chartTooltip">
                  <div class="chart-tooltip-header">
                    <span class="chart-tooltip-channel" id="tooltipChannel">Permanent</span>
                    <span class="chart-tooltip-badge">Daily Rate</span>
                  </div>
                  <div class="chart-tooltip-body">
                    <div class="chart-tooltip-stats">
                      <div class="chart-tooltip-stat"><span class="chart-tooltip-stat-label">90th %ile</span><span class="chart-tooltip-stat-value high" id="tooltipHigh">$1,200</span></div>
                      <div class="chart-tooltip-stat"><span class="chart-tooltip-stat-label">Median</span><span class="chart-tooltip-stat-value median" id="tooltipMedian">$850</span></div>
                      <div class="chart-tooltip-stat"><span class="chart-tooltip-stat-label">10th %ile</span><span class="chart-tooltip-stat-value low" id="tooltipLow">$550</span></div>
                      <div class="chart-tooltip-stat"><span class="chart-tooltip-stat-label">Spread</span><span class="chart-tooltip-stat-value" id="tooltipSpread">$650</span></div>
                    </div>
                    <div class="chart-tooltip-regions" id="tooltipRegions"></div>
                  </div>
                </div>
              </div>
            </div>
            <div class="chart-legend">
              <div class="chart-legend-item"><div class="chart-legend-icon"><div class="chart-legend-wick"></div><div class="chart-legend-body"></div><div class="chart-legend-wick"></div></div><span>Rate range (10th–90th percentile)</span></div>
              <div class="chart-legend-item"><div class="chart-legend-line"></div><span>Median rate</span></div>
            </div>
            <div class="chart-data-table" id="chartDataTable"></div>
            <div class="chart-sources"><span class="chart-source"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>ILO Labour Cost Index</span><span class="chart-source"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 20V10M12 20V4M6 20v-6"/></svg>OECD Unit Labour Cost</span><span class="chart-source"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5M2 12l10 5 10-5"/></svg>Deployed Rate Intelligence</span></div>
          </div>
        </div>
        <div class="panel full-width">
          <div class="panel-header"><span class="panel-title">Automation & AI Suitability</span></div>
          <div class="panel-body">
            <div class="ai-task-list" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 10px;"><div class="ai-task-item"><span class="ai-task-name">Status reporting</span><span class="ai-task-badge automatable">Automatable</span></div><div class="ai-task-item"><span class="ai-task-name">Plan tracking</span><span class="ai-task-badge augmentable">Augmentable</span></div><div class="ai-task-item"><span class="ai-task-name">Risk identification</span><span class="ai-task-badge augmentable">Augmentable</span></div><div class="ai-task-item"><span class="ai-task-name">Stakeholder negotiation</span><span class="ai-task-badge human-led">Human-led</span></div><div class="ai-task-item"><span class="ai-task-name">Team leadership</span><span class="ai-task-badge human-led">Human-led</span></div><div class="ai-task-item"><span class="ai-task-name">Decision making</span><span class="ai-task-badge human-led">Human-led</span></div></div>
            <div class="ai-signal"><div class="ai-signal-label">Overall Signal</div><div class="ai-signal-text">"AI likely augments junior delivery first, but senior judgment and stakeholder relationships remain human-led"</div></div>
          </div>
        </div>
      </div>
    </section>

    <!-- DEEP DIVE SCREEN -->
    <section id="deepDiveScreen" class="screen">
      <div class="deep-dive-container">
        <div class="deep-dive-header"><h2 class="deep-dive-title">Deep Dive: Refine Your Requirements</h2><p class="deep-dive-subtitle">Answer a few questions to get more precise specifications.</p></div>
        <div class="deep-dive-progress"><div class="progress-step active"></div><div class="progress-step"></div><div class="progress-step"></div><div class="progress-step"></div><div class="progress-step"></div></div>
        <div class="deep-dive-question" id="deepDiveQuestion"></div>
        <div class="deep-dive-nav"><button class="btn-back" onclick="deepDiveBack()">Back</button><button class="btn-next" id="deepDiveNextBtn" onclick="deepDiveNext()" disabled>Continue</button></div>
      </div>
    </section>

    <footer><div>© <span id="year"></span> triangulate.dev — workforce data platform powered by Deployed</div><div class="footer-links"><a href="#" onclick="resetToEntry(); return false;">New Query</a><a href="data-sources.html">Data Sources</a><a href="#">Documentation</a><a href="#">API</a></div></footer>
  </div>

  <!-- MCP MODAL -->
  <div class="modal-overlay" id="mcpModal">
    <div class="modal">
      <button class="modal-close" onclick="closeMCPModal()"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg></button>
      <div class="modal-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M5 12h14"/></svg></div>
      <h2>Add Your Context (MCP)</h2>
      <p class="modal-subtitle">Connect your organization's data sources to get personalized workforce intelligence.</p>
      <div class="upload-section"><label class="upload-label">Business Case Register</label><div class="upload-area"><div class="upload-area-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg></div><div class="upload-area-text">Click to upload</div><div class="upload-area-hint">Excel, CSV, or PDF</div></div></div>
      <div class="upload-section"><label class="upload-label">Strategy Documents</label><div class="upload-area"><div class="upload-area-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg></div><div class="upload-area-text">Click to upload</div><div class="upload-area-hint">PDF, Word, PowerPoint</div></div></div>
      <div class="upload-section"><label class="upload-label">Project Database</label><div class="upload-area"><div class="upload-area-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/></svg></div><div class="upload-area-text">Click to upload</div><div class="upload-area-hint">Excel, CSV, JSON</div></div></div>
      <div class="upload-section"><label class="upload-label">Preferred Supplier List</label><div class="upload-area"><div class="upload-area-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="8.5" cy="7" r="4"/><line x1="20" y1="8" x2="20" y2="14"/><line x1="23" y1="11" x2="17" y2="11"/></svg></div><div class="upload-area-text">Click to upload</div><div class="upload-area-hint">Excel or CSV</div></div></div>
      <div class="upload-section"><label class="upload-label">Job Titles / Job Families</label><div class="upload-area"><div class="upload-area-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg></div><div class="upload-area-text">Click to upload</div><div class="upload-area-hint">Excel or CSV</div></div></div>
      <div class="upload-section"><label class="upload-label">Supplier Categories</label><div class="upload-area"><div class="upload-area-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg></div><div class="upload-area-text">Click to upload</div><div class="upload-area-hint">Excel or CSV</div></div></div>
      <div style="text-align: center;"><div class="coming-soon-badge"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>Coming Soon</div></div>
    </div>
  </div>

  <!-- UPLOAD DOCUMENT MODAL -->
  <div class="modal-overlay" id="uploadModal">
    <div class="modal upload-modal">
      <button class="modal-close" onclick="closeUploadModal()"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg></button>
      
      <div class="upload-modal-header">
        <div class="upload-modal-badge">🎉 COMING SOON 🎉</div>
        <div class="upload-modal-title">Document Upload</div>
      </div>

      <div class="upload-dropzone" id="uploadDropzone">
        <div class="upload-dropzone-icon">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
        </div>
        <div class="upload-dropzone-text">Drag & drop your file here</div>
        <div class="upload-dropzone-hint">or <span>browse to find a file</span></div>
      </div>

      <div class="upload-types">
        <div class="upload-type-card">
          <div class="upload-type-header">
            <div class="upload-type-icon blue">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>
            </div>
            <div class="upload-type-title">Project Documents</div>
          </div>
          <div class="upload-type-desc">Upload your project requirements, business case, project brief, or scope of work and we'll estimate your workforce requirements. We may ask you to add context depending on what file you've uploaded.</div>
        </div>

        <div class="upload-type-card">
          <div class="upload-type-header">
            <div class="upload-type-icon purple">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="12" y1="18" x2="12" y2="12"/><line x1="9" y1="15" x2="15" y2="15"/></svg>
            </div>
            <div class="upload-type-title">Proposal or Statement of Work</div>
          </div>
          <div class="upload-type-desc">Upload your proposal or statement of work that already includes people, roles, rates, and pricing. We'll compare it against global salary and services benchmarks to evaluate seniority, effort, and rates against the market.</div>
        </div>
      </div>
    </div>
  </div>

  <script>
    function initTheme() { const s = localStorage.getItem('triangulate-theme'), p = window.matchMedia('(prefers-color-scheme: dark)').matches; document.documentElement.setAttribute('data-theme', s || (p ? 'dark' : 'light')); }
    document.getElementById('themeToggle').addEventListener('click', () => { const n = document.documentElement.getAttribute('data-theme') === 'dark' ? 'light' : 'dark'; document.documentElement.setAttribute('data-theme', n); localStorage.setItem('triangulate-theme', n); initChart(); });
    initTheme();

    let currentScreen = 'entry', deepDiveStep = 0, deepDiveAnswers = {}, activeRegions = ['usa'];
    const costData = { channels: ['Permanent', 'Contingent', 'Short Term Service'], regions: { usa: { name: 'United States', color: '#f87171', data: { 'Permanent': { low: 550, median: 850, high: 1200 }, 'Contingent': { low: 700, median: 1050, high: 1500 }, 'Short Term Service': { low: 1000, median: 1500, high: 2200 } } }, uk: { name: 'United Kingdom', color: '#818cf8', data: { 'Permanent': { low: 450, median: 650, high: 900 }, 'Contingent': { low: 550, median: 800, high: 1100 }, 'Short Term Service': { low: 800, median: 1200, high: 1800 } } }, france: { name: 'France', color: '#3b82f6', data: { 'Permanent': { low: 400, median: 600, high: 850 }, 'Contingent': { low: 500, median: 720, high: 1000 }, 'Short Term Service': { low: 720, median: 1050, high: 1550 } } }, germany: { name: 'Germany', color: '#f59e0b', data: { 'Permanent': { low: 420, median: 620, high: 850 }, 'Contingent': { low: 520, median: 750, high: 1050 }, 'Short Term Service': { low: 750, median: 1100, high: 1650 } } }, poland: { name: 'Poland', color: '#10b981', data: { 'Permanent': { low: 180, median: 320, high: 480 }, 'Contingent': { low: 220, median: 400, high: 600 }, 'Short Term Service': { low: 350, median: 550, high: 850 } } }, india: { name: 'India', color: '#06b6d4', data: { 'Permanent': { low: 120, median: 220, high: 380 }, 'Contingent': { low: 150, median: 280, high: 450 }, 'Short Term Service': { low: 250, median: 420, high: 700 } } }, philippines: { name: 'Philippines', color: '#ec4899', data: { 'Permanent': { low: 80, median: 160, high: 280 }, 'Contingent': { low: 100, median: 200, high: 350 }, 'Short Term Service': { low: 180, median: 320, high: 550 } } } } };

    // ================================================
    // PROFESSIONAL CHART - TradingView Inspired Canvas
    // ================================================
    const chartState = {
      canvas: null,
      ctx: null,
      dpr: 1,
      width: 0,
      height: 0,
      padding: { top: 50, right: 80, bottom: 90, left: 80 },
      maxY: 0,
      hoveredBar: null,
      hoveredChannel: null,
      bars: [],
      animationProgress: 0,
      animationId: null,
      showLinesOnly: false
    };

    function initChart() {
      const container = document.getElementById('chartContainer');
      const canvas = document.getElementById('chartCanvas');
      if (!container || !canvas) {
        console.error('Chart container or canvas not found');
        return;
      }
      
      chartState.canvas = canvas;
      chartState.ctx = canvas.getContext('2d');
      chartState.dpr = window.devicePixelRatio || 1;
      
      // Size canvas
      const rect = container.getBoundingClientRect();
      chartState.width = rect.width;
      chartState.height = rect.height;
      
      // Handle case when container has no size
      if (chartState.width === 0 || chartState.height === 0) {
        console.warn('Chart container has no size, using defaults');
        chartState.width = 800;
        chartState.height = 520;
      }
      
      canvas.width = chartState.width * chartState.dpr;
      canvas.height = chartState.height * chartState.dpr;
      canvas.style.width = chartState.width + 'px';
      canvas.style.height = chartState.height + 'px';
      chartState.ctx.scale(chartState.dpr, chartState.dpr);
      
      // Calculate max Y
      // Fixed Y-axis max for demo: 0, 500, 1000, 1500, 2000, 2500
      chartState.maxY = 2500;
      
      // Calculate bar positions
      calculateBarPositions();
      
      // Animate in
      chartState.animationProgress = 0;
      if (chartState.animationId) cancelAnimationFrame(chartState.animationId);
      animateChart();
      
      // Event listeners
      canvas.onmousemove = handleChartMouseMove;
      canvas.onmouseleave = handleChartMouseLeave;
    }

    function calculateBarPositions() {
      chartState.bars = [];
      const p = chartState.padding;
      const chartWidth = chartState.width - p.left - p.right;
      const chartHeight = chartState.height - p.top - p.bottom;
      const channelWidth = chartWidth / costData.channels.length;
      const barWidth = Math.min(70, Math.max(40, channelWidth / (activeRegions.length + 1)));
      const barGap = 14;
      
      costData.channels.forEach((channel, ci) => {
        const channelCenterX = p.left + channelWidth * ci + channelWidth / 2;
        const totalBarsWidth = activeRegions.length * barWidth + (activeRegions.length - 1) * barGap;
        const startX = channelCenterX - totalBarsWidth / 2;
        
        activeRegions.forEach((regionKey, ri) => {
          const region = costData.regions[regionKey];
          const data = region.data[channel];
          const x = startX + ri * (barWidth + barGap);
          const yHigh = p.top + chartHeight - (data.high / chartState.maxY * chartHeight);
          const yLow = p.top + chartHeight - (data.low / chartState.maxY * chartHeight);
          const yMedian = p.top + chartHeight - (data.median / chartState.maxY * chartHeight);
          
          chartState.bars.push({
            channel,
            regionKey,
            region,
            data,
            x,
            width: barWidth,
            yHigh,
            yLow,
            yMedian,
            color: region.color,
            channelCenterX
          });
        });
      });
    }

    function animateChart() {
      chartState.animationProgress += 0.08;
      if (chartState.animationProgress > 1) chartState.animationProgress = 1;
      
      renderChart();
      
      if (chartState.animationProgress < 1) {
        chartState.animationId = requestAnimationFrame(animateChart);
      }
    }

    function renderChart() {
      const ctx = chartState.ctx;
      const w = chartState.width;
      const h = chartState.height;
      const p = chartState.padding;
      const progress = easeOutCubic(chartState.animationProgress);
      
      // Get theme colors
      const st = getComputedStyle(document.documentElement);
      const bgColor = st.getPropertyValue('--panel').trim();
      const borderColor = st.getPropertyValue('--border').trim();
      const textColor = st.getPropertyValue('--text-secondary').trim();
      const mutedColor = st.getPropertyValue('--muted').trim();
      const accentColor = st.getPropertyValue('--accent').trim();
      
      // Clear canvas
      ctx.fillStyle = bgColor;
      ctx.fillRect(0, 0, w, h);
      
      // Draw grid lines
      ctx.strokeStyle = borderColor;
      ctx.lineWidth = 1;
      ctx.setLineDash([4, 4]);
      
      for (let i = 0; i <= 5; i++) {
        const y = p.top + ((h - p.top - p.bottom) / 5) * i;
        ctx.beginPath();
        ctx.moveTo(p.left, y);
        ctx.lineTo(w - p.right, y);
        ctx.stroke();
      }
      ctx.setLineDash([]);
      
      // Draw Y-axis labels
      ctx.font = '500 11px "JetBrains Mono", monospace';
      ctx.fillStyle = mutedColor;
      ctx.textAlign = 'right';
      ctx.textBaseline = 'middle';
      
      for (let i = 0; i <= 5; i++) {
        const y = p.top + ((h - p.top - p.bottom) / 5) * i;
        const value = Math.round(chartState.maxY - (chartState.maxY / 5) * i);
        ctx.fillText('$' + value.toLocaleString(), p.left - 14, y);
      }
      
      // Draw axes
      ctx.strokeStyle = borderColor;
      ctx.lineWidth = 1;
      ctx.beginPath();
      ctx.moveTo(p.left, p.top);
      ctx.lineTo(p.left, h - p.bottom);
      ctx.lineTo(w - p.right, h - p.bottom);
      ctx.stroke();
      
      // Draw channel labels
      ctx.font = '600 13px "Space Grotesk", sans-serif';
      ctx.fillStyle = textColor;
      ctx.textAlign = 'center';
      ctx.textBaseline = 'top';
      
      const channelWidth = (w - p.left - p.right) / costData.channels.length;
      costData.channels.forEach((channel, i) => {
        const x = p.left + channelWidth * i + channelWidth / 2;
        ctx.fillText(channel, x, h - p.bottom + 20);
      });
      
      // Draw bars with animation (skip if showLinesOnly mode)
      if (!chartState.showLinesOnly) {
        chartState.bars.forEach((bar, idx) => {
          const isHovered = chartState.hoveredBar === idx;
          const barProgress = Math.min(1, progress * 1.5 - (idx * 0.05));
          if (barProgress <= 0) return;
        
        // Animated positions - bars grow from bottom
        const baseY = h - p.bottom;
        const animatedYHigh = baseY - (baseY - bar.yHigh) * barProgress;
        const animatedYLow = baseY - (baseY - bar.yLow) * barProgress;
        const animatedYMedian = baseY - (baseY - bar.yMedian) * barProgress;
        
        const totalHeight = animatedYLow - animatedYHigh;
        const centerX = bar.x + bar.width / 2;
        const capWidth = bar.width * 0.5;
        
        // Body is smaller - 10% inset from each end, narrow width to match median
        const bodyInset = totalHeight * 0.1;
        const bodyTop = animatedYHigh + bodyInset;
        const bodyBottom = animatedYLow - bodyInset;
        const bodyWidth = bar.width * 0.25; // Match median line width
        const bodyX = bar.x + (bar.width - bodyWidth) / 2;
        
        // 1. Draw vertical wick line (thin center line - full height)
        ctx.strokeStyle = bar.color;
        ctx.lineWidth = 2;
        ctx.lineCap = 'round';
        ctx.beginPath();
        ctx.moveTo(centerX, animatedYHigh);
        ctx.lineTo(centerX, animatedYLow);
        ctx.stroke();
        
        // 2. Draw TOP cap (horizontal line at 90th percentile)
        ctx.strokeStyle = bar.color;
        ctx.lineWidth = isHovered ? 4 : 3;
        ctx.lineCap = 'round';
        ctx.beginPath();
        ctx.moveTo(centerX - capWidth / 2, animatedYHigh);
        ctx.lineTo(centerX + capWidth / 2, animatedYHigh);
        ctx.stroke();
        
        // 3. Draw BOTTOM cap (horizontal line at 10th percentile)
        ctx.beginPath();
        ctx.moveTo(centerX - capWidth / 2, animatedYLow);
        ctx.lineTo(centerX + capWidth / 2, animatedYLow);
        ctx.stroke();
        
        // 4. Draw body (semi-transparent box - NOT full height)
        const bodyHeight = bodyBottom - bodyTop;
        ctx.fillStyle = hexToRgba(bar.color, isHovered ? 0.3 : 0.15);
        ctx.strokeStyle = bar.color;
        ctx.lineWidth = isHovered ? 2.5 : 2;
        
        // Rounded rectangle for body
        const radius = Math.min(6, bodyHeight / 4, bodyWidth / 4);
        ctx.beginPath();
        ctx.moveTo(bodyX + radius, bodyTop);
        ctx.lineTo(bodyX + bodyWidth - radius, bodyTop);
        ctx.quadraticCurveTo(bodyX + bodyWidth, bodyTop, bodyX + bodyWidth, bodyTop + radius);
        ctx.lineTo(bodyX + bodyWidth, bodyBottom - radius);
        ctx.quadraticCurveTo(bodyX + bodyWidth, bodyBottom, bodyX + bodyWidth - radius, bodyBottom);
        ctx.lineTo(bodyX + radius, bodyBottom);
        ctx.quadraticCurveTo(bodyX, bodyBottom, bodyX, bodyBottom - radius);
        ctx.lineTo(bodyX, bodyTop + radius);
        ctx.quadraticCurveTo(bodyX, bodyTop, bodyX + radius, bodyTop);
        ctx.closePath();
        ctx.fill();
        ctx.stroke();
        
        // 5. Draw MEDIAN line (25% width)
        const medianWidth = bodyWidth * 0.25;
        ctx.strokeStyle = bar.color;
        ctx.lineWidth = isHovered ? 4 : 3;
        ctx.lineCap = 'round';
        ctx.beginPath();
        ctx.moveTo(centerX - medianWidth / 2, animatedYMedian);
        ctx.lineTo(centerX + medianWidth / 2, animatedYMedian);
        ctx.stroke();
        
        // 6. Draw median value label (if few regions)
        if (activeRegions.length <= 2 && barProgress >= 0.9) {
          ctx.font = '600 11px "JetBrains Mono", monospace';
          ctx.fillStyle = bar.color;
          ctx.textAlign = 'center';
          ctx.textBaseline = 'bottom';
          ctx.fillText('$' + bar.data.median, centerX, animatedYMedian - 12);
        }
      });
      } // End of !showLinesOnly check
      
      // Draw connecting lines when multiple regions selected OR when showLinesOnly mode
      if ((activeRegions.length > 1 || chartState.showLinesOnly) && chartState.animationProgress >= 1) {
        costData.channels.forEach((channel, ci) => {
          const channelBars = chartState.bars.filter(b => b.channel === channel);
          if (channelBars.length < 2) return;
          
          const isDark = document.documentElement.getAttribute('data-theme') !== 'light';
          const lineColor = isDark ? 'rgba(140, 140, 160, 0.85)' : 'rgba(70, 70, 90, 0.7)';
          const medianColor = isDark ? 'rgba(180, 180, 200, 0.95)' : 'rgba(50, 50, 70, 0.85)';
          
          // High line (90th percentile)
          ctx.strokeStyle = lineColor;
          ctx.lineWidth = 2.5;
          ctx.setLineDash([6, 4]);
          ctx.beginPath();
          channelBars.forEach((bar, i) => {
            const x = bar.x + bar.width / 2;
            const y = p.top + (h - p.top - p.bottom) - (bar.data.high / chartState.maxY * (h - p.top - p.bottom));
            if (i === 0) ctx.moveTo(x, y);
            else ctx.lineTo(x, y);
          });
          ctx.stroke();
          
          // Median line - most prominent, solid
          ctx.strokeStyle = medianColor;
          ctx.lineWidth = 3.5;
          ctx.setLineDash([]);
          ctx.beginPath();
          channelBars.forEach((bar, i) => {
            const x = bar.x + bar.width / 2;
            const y = p.top + (h - p.top - p.bottom) - (bar.data.median / chartState.maxY * (h - p.top - p.bottom));
            if (i === 0) ctx.moveTo(x, y);
            else ctx.lineTo(x, y);
          });
          ctx.stroke();
          
          // Low line (10th percentile)
          ctx.strokeStyle = lineColor;
          ctx.lineWidth = 2.5;
          ctx.setLineDash([6, 4]);
          ctx.beginPath();
          channelBars.forEach((bar, i) => {
            const x = bar.x + bar.width / 2;
            const y = p.top + (h - p.top - p.bottom) - (bar.data.low / chartState.maxY * (h - p.top - p.bottom));
            if (i === 0) ctx.moveTo(x, y);
            else ctx.lineTo(x, y);
          });
          ctx.stroke();
          ctx.setLineDash([]);
          
          // Draw colored dots at each data point when in showLinesOnly mode
          if (chartState.showLinesOnly) {
            channelBars.forEach((bar) => {
              const x = bar.x + bar.width / 2;
              const yHigh = p.top + (h - p.top - p.bottom) - (bar.data.high / chartState.maxY * (h - p.top - p.bottom));
              const yMedian = p.top + (h - p.top - p.bottom) - (bar.data.median / chartState.maxY * (h - p.top - p.bottom));
              const yLow = p.top + (h - p.top - p.bottom) - (bar.data.low / chartState.maxY * (h - p.top - p.bottom));
              
              // Draw dots with region color
              ctx.fillStyle = bar.color;
              
              // High dot
              ctx.beginPath();
              ctx.arc(x, yHigh, 5, 0, Math.PI * 2);
              ctx.fill();
              
              // Median dot (larger)
              ctx.beginPath();
              ctx.arc(x, yMedian, 7, 0, Math.PI * 2);
              ctx.fill();
              
              // Low dot
              ctx.beginPath();
              ctx.arc(x, yLow, 5, 0, Math.PI * 2);
              ctx.fill();
            });
          }
        });
      }
      
      // Draw legend if multiple regions
      if (activeRegions.length > 1) {
        const legendY = h - 25;
        const legendItemWidth = 130;
        const totalWidth = activeRegions.length * legendItemWidth;
        const startX = w / 2 - totalWidth / 2;
        
        activeRegions.forEach((regionKey, i) => {
          const region = costData.regions[regionKey];
          const x = startX + i * legendItemWidth;
          
          // Dot
          ctx.beginPath();
          ctx.arc(x + 8, legendY, 5, 0, Math.PI * 2);
          ctx.fillStyle = region.color;
          ctx.fill();
          
          // Shadow glow
          ctx.shadowColor = region.color;
          ctx.shadowBlur = 8;
          ctx.fill();
          ctx.shadowBlur = 0;
          
          // Label
          ctx.font = '500 11px "Space Grotesk", sans-serif';
          ctx.fillStyle = textColor;
          ctx.textAlign = 'left';
          ctx.textBaseline = 'middle';
          ctx.fillText(region.name, x + 20, legendY);
        });
      }
    }

    function handleChartMouseMove(e) {
      const rect = chartState.canvas.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;
      
      // Find hovered bar
      let foundBar = null;
      chartState.bars.forEach((bar, idx) => {
        if (x >= bar.x && x <= bar.x + bar.width && y >= bar.yHigh - 10 && y <= bar.yLow + 10) {
          foundBar = idx;
        }
      });
      
      // Update crosshair
      const crosshair = document.getElementById('chartCrosshair');
      const crosshairH = document.getElementById('crosshairH');
      const crosshairV = document.getElementById('crosshairV');
      const crosshairYLabel = document.getElementById('crosshairYLabel');
      const crosshairXLabel = document.getElementById('crosshairXLabel');
      
      crosshair.style.display = 'block';
      crosshairH.style.top = y + 'px';
      crosshairH.style.left = chartState.padding.left + 'px';
      crosshairH.style.right = chartState.padding.right + 'px';
      crosshairV.style.left = x + 'px';
      crosshairV.style.top = chartState.padding.top + 'px';
      crosshairV.style.bottom = chartState.padding.bottom + 'px';
      
      // Calculate Y value from position
      const chartHeight = chartState.height - chartState.padding.top - chartState.padding.bottom;
      const relativeY = y - chartState.padding.top;
      const yValue = Math.round(chartState.maxY * (1 - relativeY / chartHeight));
      crosshairYLabel.textContent = '$' + Math.max(0, yValue).toLocaleString();
      crosshairYLabel.style.top = y + 'px';
      
      // Find channel under cursor
      const channelWidth = (chartState.width - chartState.padding.left - chartState.padding.right) / costData.channels.length;
      const relativeX = x - chartState.padding.left;
      const channelIndex = Math.floor(relativeX / channelWidth);
      if (channelIndex >= 0 && channelIndex < costData.channels.length) {
        crosshairXLabel.textContent = costData.channels[channelIndex];
        crosshairXLabel.style.left = (chartState.padding.left + channelWidth * channelIndex + channelWidth / 2) + 'px';
      }
      
      // Show tooltip if hovering bar
      if (foundBar !== null && chartState.hoveredBar !== foundBar) {
        chartState.hoveredBar = foundBar;
        renderChart();
        showChartTooltip(chartState.bars[foundBar], e);
      } else if (foundBar === null && chartState.hoveredBar !== null) {
        chartState.hoveredBar = null;
        renderChart();
        hideChartTooltip();
      } else if (foundBar !== null) {
        moveChartTooltip(e);
      }
      
      chartState.canvas.style.cursor = foundBar !== null ? 'pointer' : 'crosshair';
    }

    function handleChartMouseLeave() {
      const crosshair = document.getElementById('chartCrosshair');
      crosshair.style.display = 'none';
      chartState.hoveredBar = null;
      renderChart();
      hideChartTooltip();
    }

    function showChartTooltip(bar, e) {
      const tooltip = document.getElementById('chartTooltip');
      const channel = document.getElementById('tooltipChannel');
      const high = document.getElementById('tooltipHigh');
      const median = document.getElementById('tooltipMedian');
      const low = document.getElementById('tooltipLow');
      const spread = document.getElementById('tooltipSpread');
      const regions = document.getElementById('tooltipRegions');
      
      // Set accent color
      tooltip.style.setProperty('--tooltip-accent', bar.color);
      
      channel.textContent = bar.channel;
      high.textContent = '$' + bar.data.high.toLocaleString();
      median.textContent = '$' + bar.data.median.toLocaleString();
      low.textContent = '$' + bar.data.low.toLocaleString();
      spread.textContent = '$' + (bar.data.high - bar.data.low).toLocaleString();
      
      // Region comparison
      if (activeRegions.length > 1) {
        regions.innerHTML = '<div class="chart-tooltip-regions-title">Region Comparison</div>' +
          activeRegions.map(rk => {
            const r = costData.regions[rk];
            const d = r.data[bar.channel];
            const isActive = rk === bar.regionKey;
            return `<div class="chart-tooltip-region-row">
              <span class="chart-tooltip-region-dot" style="background:${r.color};${isActive ? 'box-shadow:0 0 8px ' + r.color : ''}"></span>
              <span class="chart-tooltip-region-name">${r.name}${isActive ? ' ●' : ''}</span>
              <span class="chart-tooltip-region-value" style="${isActive ? 'color:' + r.color : ''}">$${d.median.toLocaleString()}</span>
            </div>`;
          }).join('');
      } else {
        regions.innerHTML = `<div class="chart-tooltip-regions-title">Region</div>
          <div class="chart-tooltip-region-row">
            <span class="chart-tooltip-region-dot" style="background:${bar.color}"></span>
            <span class="chart-tooltip-region-name">${bar.region.name}</span>
          </div>`;
      }
      
      tooltip.classList.add('visible');
      moveChartTooltip(e);
    }

    function moveChartTooltip(e) {
      const tooltip = document.getElementById('chartTooltip');
      const container = document.getElementById('chartContainer');
      const rect = container.getBoundingClientRect();
      
      let x = e.clientX - rect.left + 20;
      let y = e.clientY - rect.top - 20;
      
      // Keep tooltip in bounds
      const tooltipRect = tooltip.getBoundingClientRect();
      if (x + tooltipRect.width > rect.width - 10) {
        x = e.clientX - rect.left - tooltipRect.width - 20;
      }
      if (y + tooltipRect.height > rect.height - 10) {
        y = rect.height - tooltipRect.height - 10;
      }
      if (y < 10) y = 10;
      
      tooltip.style.left = x + 'px';
      tooltip.style.top = y + 'px';
    }

    function hideChartTooltip() {
      document.getElementById('chartTooltip').classList.remove('visible');
    }

    function toggleRegion(btn) {
      const region = btn.dataset.region;
      const idx = activeRegions.indexOf(region);
      
      // Deactivate All button when individual regions are toggled
      const allBtn = document.querySelector('.region-chip[data-region="all"]');
      if (allBtn) allBtn.classList.remove('active');
      chartState.showLinesOnly = false;
      
      if (idx > -1) {
        if (activeRegions.length > 1) {
          activeRegions.splice(idx, 1);
          btn.classList.remove('active');
        }
      } else {
        activeRegions.push(region);
        btn.classList.add('active');
      }
      
      initChart();
      renderDataTable();
    }
    
    function toggleAllRegions(btn) {
      const allRegionKeys = Object.keys(costData.regions);
      
      if (btn.classList.contains('active')) {
        // Deactivate: go back to just USA
        btn.classList.remove('active');
        chartState.showLinesOnly = false;
        activeRegions.length = 0;
        activeRegions.push('usa');
        
        // Update individual region buttons
        document.querySelectorAll('.region-chip[data-region]').forEach(chip => {
          if (chip.dataset.region === 'usa') chip.classList.add('active');
          else if (chip.dataset.region !== 'all') chip.classList.remove('active');
        });
      } else {
        // Activate: select all regions, show lines only
        btn.classList.add('active');
        chartState.showLinesOnly = true;
        activeRegions.length = 0;
        allRegionKeys.forEach(k => activeRegions.push(k));
        
        // Update individual region buttons
        document.querySelectorAll('.region-chip[data-region]').forEach(chip => {
          if (chip.dataset.region !== 'all') chip.classList.add('active');
        });
      }
      
      initChart();
      renderDataTable();
    }

    // Helper functions
    function hexToRgba(hex, alpha) {
      const r = parseInt(hex.slice(1, 3), 16);
      const g = parseInt(hex.slice(3, 5), 16);
      const b = parseInt(hex.slice(5, 7), 16);
      return `rgba(${r}, ${g}, ${b}, ${alpha})`;
    }

    function roundedRect(ctx, x, y, width, height, radius) {
      ctx.beginPath();
      ctx.moveTo(x + radius, y);
      ctx.lineTo(x + width - radius, y);
      ctx.quadraticCurveTo(x + width, y, x + width, y + radius);
      ctx.lineTo(x + width, y + height - radius);
      ctx.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);
      ctx.lineTo(x + radius, y + height);
      ctx.quadraticCurveTo(x, y + height, x, y + height - radius);
      ctx.lineTo(x, y + radius);
      ctx.quadraticCurveTo(x, y, x + radius, y);
      ctx.closePath();
    }

    function easeOutCubic(t) {
      return 1 - Math.pow(1 - t, 3);
    }

    // Alias for compatibility
    function renderCandlestickChart() {
      initChart();
    }

    function renderDataTable() {
      const table = document.getElementById('chartDataTable');
      let html = '<table><thead><tr><th>Region</th>';
      costData.channels.forEach(ch => { html += '<th>'+ch+'</th>'; });
      html += '</tr></thead><tbody>';
      activeRegions.forEach(rk => {
        const r = costData.regions[rk];
        html += '<tr><td><span class="region-indicator"><span class="region-dot" style="background:'+r.color+'"></span>'+r.name+'</span></td>';
        costData.channels.forEach(ch => {
          const d = r.data[ch];
          html += '<td>$'+d.low.toLocaleString()+' – $'+d.high.toLocaleString()+' <span style="color:var(--accent);font-weight:600;">($'+d.median.toLocaleString()+')</span></td>';
        });
        html += '</tr>';
      });
      html += '</tbody></table>';
      table.innerHTML = html;
    }

    const deepDiveQuestions = [{ id: 'scope', question: 'What is the primary scope of this role?', options: ['Coordinating delivery across teams', 'Owning end-to-end outcomes', 'Strategic oversight and governance', 'Hands-on execution and support'] }, { id: 'autonomy', question: 'What level of autonomy would this person have?', options: ['Works independently with minimal oversight', 'Regular check-ins with manager', 'Close collaboration with senior leadership', 'Part of a larger team structure'] }, { id: 'duration', question: 'What is the expected engagement duration?', options: ['Short-term (< 3 months)', 'Medium-term (3-6 months)', 'Long-term (6-12 months)', 'Ongoing / Permanent'] }, { id: 'budget', question: 'What is your approximate daily rate budget?', options: ['Under $500 / day', '$500 - $850 / day', '$850 - $1,200 / day', 'Over $1,200 / day', 'Flexible / Need guidance'] }, { id: 'channel', question: 'What is your preferred fulfilment channel?', options: ['Direct contractor', 'Through a staffing agency', 'Consulting firm / SOW-based', 'Internal hire', 'Open to recommendations'] }];
    const exampleInterpretations = { 'I need a project manager for a CRM migration': { intents: [{ type: 'title', icon: 'T', value: 'Project Manager' }, { type: 'jtbd', icon: 'J', value: 'CRM migration' }], clarification: { question: 'Is this role mainly about:', options: ['Coordinating delivery', 'Owning outcomes', 'Both'] }, workspace: { title: 'Project delivery leadership for CRM migration', subtitle: 'Entry lens: Job title + Job-to-be-done', need: 'You need a mid-to-senior level professional who can lead the delivery of a CRM migration project, coordinating cross-functional teams, managing timelines, and ensuring stakeholder alignment throughout the transformation.' } }, 'Senior data engineer for our ML pipeline': { intents: [{ type: 'title', icon: 'T', value: 'Data Engineer' }, { type: 'skill', icon: 'S', value: 'ML pipeline' }], clarification: { question: 'What is the primary focus:', options: ['Building infrastructure', 'Optimizing performance', 'Both'] }, workspace: { title: 'ML data infrastructure engineering', subtitle: 'Entry lens: Job title + Skills', need: 'You need a senior data engineer with expertise in ML pipelines, capable of designing and maintaining data infrastructure that supports machine learning workloads at scale.' } }, 'I need to reduce our contractor spend by 20%': { intents: [{ type: 'outcome', icon: 'O', value: 'Reduce contractor spend by 20%' }, { type: 'problem', icon: 'P', value: 'No visibility into rates' }], clarification: { question: 'Which approach aligns with your priority:', options: ['Rate optimization', 'Headcount reduction', 'Process efficiency'] }, workspace: { title: 'Contractor spend optimization program', subtitle: 'Entry lens: Outcome-led + Problem', need: 'You need to achieve a 20% reduction in contractor spend through rate benchmarking, vendor consolidation, and improved visibility into your contractor portfolio performance.' } }, 'Python, AWS, Kubernetes skills for DevOps': { intents: [{ type: 'skill', icon: 'S', value: 'Python, AWS, Kubernetes' }, { type: 'title', icon: 'T', value: 'DevOps' }], clarification: { question: 'Is this skill set for:', options: ['Hands-on engineering', 'Architecture & design', 'Team leadership'] }, workspace: { title: 'DevOps engineering with cloud-native skills', subtitle: 'Entry lens: Skills + Job title', need: 'You need a DevOps professional with hands-on experience in Python, AWS, and Kubernetes to build and maintain cloud-native infrastructure and CI/CD pipelines.' } }, 'Transform our customer onboarding process': { intents: [{ type: 'outcome', icon: 'O', value: 'Transform customer onboarding' }, { type: 'jtbd', icon: 'J', value: 'Process transformation' }], clarification: { question: 'What is your primary constraint:', options: ['Speed', 'Cost', 'Quality', 'Risk'] }, workspace: { title: 'Customer onboarding transformation', subtitle: 'Entry lens: Outcome + Job-to-be-done', need: 'You need to redesign the customer onboarding experience to reduce early churn and improve NPS scores.' } } };
    function setExample(t, p) { document.getElementById('inputTask').value = t; document.getElementById('inputProblem').value = p || ''; }
    function submitQuery() { const q = document.getElementById('inputTask').value.trim(), p = document.getElementById('inputProblem').value.trim(); if (!q) return; let i = exampleInterpretations[q] || { intents: [{ type: 'jtbd', icon: 'J', value: q.substring(0, 50) }], clarification: { question: 'To better understand your needs:', options: ['Short-term project', 'Ongoing capability', 'Strategic initiative'] }, workspace: { title: q.substring(0, 60), subtitle: 'Entry lens: Job-to-be-done', need: 'Based on your request, we have identified potential roles, skills, and delivery options.' } }; if (p && !i.intents.find(x => x.type === 'problem')) i.intents.push({ type: 'problem', icon: 'P', value: p.substring(0, 50) + '...' }); showInterpretingScreen(i); }
    function getIntentLabel(t) { return { title: 'Job title', skill: 'Skills', jtbd: 'Job-to-be-done', outcome: 'Outcome', problem: 'Problem statement' }[t] || t; }
    function showInterpretingScreen(i) { switchScreen('interpreting'); document.getElementById('detectedItems').innerHTML = i.intents.map(x => '<div class="detected-item"><div class="detected-icon '+x.type+'">'+x.icon+'</div><div class="detected-text"><div class="detected-type">'+getIntentLabel(x.type)+'</div><div class="detected-value">'+x.value+'</div></div></div>').join(''); document.getElementById('clarificationQuestion').textContent = i.clarification.question; document.getElementById('clarificationOptions').innerHTML = i.clarification.options.map(o => '<button class="clarification-option" onclick="selectClarification(this,\''+o+'\')">'+o+'</button>').join(''); window.currentInterpretation = i; }
    function selectClarification(btn, v) { document.querySelectorAll('.clarification-option').forEach(b => b.classList.remove('selected')); btn.classList.add('selected'); setTimeout(() => showWorkspaceScreen(), 500); }
    function showWorkspaceScreen() { const i = window.currentInterpretation; document.getElementById('workspaceTitle').textContent = i.workspace.title; document.getElementById('workspaceSubtitle').textContent = i.workspace.subtitle; document.getElementById('interpretedNeed').textContent = i.workspace.need; switchScreen('workspace'); setTimeout(() => { renderCandlestickChart(); renderDataTable(); }, 100); }
    function switchScreen(id) { document.querySelectorAll('.screen').forEach(s => s.classList.remove('active')); document.getElementById(id + 'Screen').classList.add('active'); currentScreen = id; window.scrollTo(0, 0); }
    function resetToEntry() { document.getElementById('inputTask').value = ''; document.getElementById('inputProblem').value = ''; switchScreen('entry'); }
    function openDeepDive() { deepDiveStep = 0; deepDiveAnswers = {}; renderDeepDiveQuestion(); switchScreen('deepDive'); }
    function renderDeepDiveQuestion() { const q = deepDiveQuestions[deepDiveStep]; document.getElementById('deepDiveQuestion').innerHTML = '<div class="question-number">Question '+(deepDiveStep+1)+' of '+deepDiveQuestions.length+'</div><div class="question-text">'+q.question+'</div><div class="question-options">'+q.options.map(o => '<button class="question-option" onclick="selectDeepDiveOption(this,\''+q.id+'\',\''+o+'\')">'+o+'</button>').join('')+'</div>'; document.querySelectorAll('.progress-step').forEach((s, i) => { s.classList.remove('active', 'completed'); if (i < deepDiveStep) s.classList.add('completed'); if (i === deepDiveStep) s.classList.add('active'); }); document.getElementById('deepDiveNextBtn').disabled = !deepDiveAnswers[q.id]; }
    function selectDeepDiveOption(btn, qid, v) { document.querySelectorAll('.question-option').forEach(b => b.classList.remove('selected')); btn.classList.add('selected'); deepDiveAnswers[qid] = v; document.getElementById('deepDiveNextBtn').disabled = false; }
    function deepDiveNext() { if (deepDiveStep < deepDiveQuestions.length - 1) { deepDiveStep++; renderDeepDiveQuestion(); } else { switchScreen('workspace'); setTimeout(() => { renderCandlestickChart(); renderDataTable(); }, 100); } }
    function deepDiveBack() { if (deepDiveStep > 0) { deepDiveStep--; renderDeepDiveQuestion(); } else { switchScreen('workspace'); setTimeout(() => { renderCandlestickChart(); renderDataTable(); }, 100); } }
    function openMCPModal() { document.getElementById('mcpModal').classList.add('active'); }
    function closeMCPModal() { document.getElementById('mcpModal').classList.remove('active'); }
    document.getElementById('mcpModal').addEventListener('click', e => { if (e.target.id === 'mcpModal') closeMCPModal(); });
    
    function openUploadModal() { document.getElementById('uploadModal').classList.add('active'); }
    function closeUploadModal() { document.getElementById('uploadModal').classList.remove('active'); }
    document.getElementById('uploadModal').addEventListener('click', e => { if (e.target.id === 'uploadModal') closeUploadModal(); });
    
    // Upload dropzone drag and drop visual feedback
    const uploadDropzone = document.getElementById('uploadDropzone');
    if (uploadDropzone) {
      uploadDropzone.addEventListener('dragover', e => { e.preventDefault(); uploadDropzone.classList.add('dragover'); });
      uploadDropzone.addEventListener('dragleave', e => { e.preventDefault(); uploadDropzone.classList.remove('dragover'); });
      uploadDropzone.addEventListener('drop', e => { e.preventDefault(); uploadDropzone.classList.remove('dragover'); });
    }
    
    document.querySelectorAll('.panel-toggle-btn').forEach(btn => { btn.addEventListener('click', () => { btn.parentElement.querySelectorAll('.panel-toggle-btn').forEach(b => b.classList.remove('active')); btn.classList.add('active'); }); });
    
    // Skills view toggle functionality
    document.getElementById('skillsToggle').addEventListener('click', (e) => {
      if (e.target.classList.contains('panel-toggle-btn')) {
        const view = e.target.dataset.view;
        document.getElementById('skillDiagramView').classList.toggle('active', view === 'diagram');
        document.getElementById('skillListView').classList.toggle('active', view === 'list');
      }
    });
    
    // Typeahead functionality
    const jobTitles = [
      'Project Manager', 'Project Support', 'Project Leader', 'Programme Manager',
      'Senior Project Manager', 'Junior Project Manager', 'Technical Project Manager',
      'Project Coordinator', 'Project Administrator', 'Project Analyst',
      'Product Manager', 'Product Owner', 'Scrum Master',
      'Data Engineer', 'Data Analyst', 'Data Scientist',
      'Software Engineer', 'DevOps Engineer', 'Cloud Engineer',
      'Business Analyst', 'Solutions Architect', 'Technical Lead'
    ];
    const inputTask = document.getElementById('inputTask');
    const typeaheadDropdown = document.getElementById('typeaheadDropdown');
    
    inputTask.addEventListener('input', (e) => {
      const val = e.target.value.toLowerCase().trim();
      if (val.length < 2) { typeaheadDropdown.classList.remove('visible'); return; }
      const matches = jobTitles.filter(t => t.toLowerCase().includes(val)).slice(0, 6);
      if (matches.length === 0) { typeaheadDropdown.classList.remove('visible'); return; }
      typeaheadDropdown.innerHTML = matches.map(m => {
        const idx = m.toLowerCase().indexOf(val);
        const highlighted = m.substring(0, idx) + '<span class="typeahead-match">' + m.substring(idx, idx + val.length) + '</span>' + m.substring(idx + val.length);
        return '<div class="typeahead-item" data-value="'+m+'">'+highlighted+'</div>';
      }).join('');
      typeaheadDropdown.classList.add('visible');
    });
    
    typeaheadDropdown.addEventListener('click', (e) => {
      if (e.target.classList.contains('typeahead-item')) {
        inputTask.value = e.target.dataset.value;
        typeaheadDropdown.classList.remove('visible');
        inputTask.focus();
      }
    });
    
    document.addEventListener('click', (e) => {
      if (!e.target.closest('.typeahead-container')) {
        typeaheadDropdown.classList.remove('visible');
      }
    });
    
    document.getElementById('year').textContent = new Date().getFullYear();
    inputTask.addEventListener('keypress', e => { if (e.key === 'Enter') { typeaheadDropdown.classList.remove('visible'); submitQuery(); } });
    
    // Debounced resize handler for chart
    let resizeTimeout;
    window.addEventListener('resize', () => {
      clearTimeout(resizeTimeout);
      resizeTimeout = setTimeout(() => {
        if (currentScreen === 'workspace') initChart();
      }, 150);
    });
  </script>
</body>
</html>
